<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="author" content="F U M">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B89KY0993B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-B89KY0993B');
    </script>

    <link rel="shortcut icon" type="image/x-icon" href="../../Asset/Image/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../../Asset/Image/Icon_1_2.jpg">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:100,300,400,500,700,900&display=swap"
        rel="stylesheet">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="utf-8" />

    <title>Kitty Hopper</title>
</head>

<body>

    <canvas id="Canvas_1"></canvas>

    <style>
        body {
            margin: 0px;
        }

        _UI_Home_1 {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.4em;
            font-weight: bold;
            color: red;
        }

        _UI_Score_1 {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.4em;
            font-weight: bold;
            color: red;
        }

        _UI_Start_1 {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.4em;
            font-weight: bold;
            color: red;
        }

        _UI_GameOver_1 {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.4em;
            font-weight: bold;
            color: red;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="../../Asset/Javascript/Game.js"></script>

    <script type="module">

        // Setup Threejs
        import * as THREE from 'https://unpkg.com/three@0.126.1/build/three.module.js';
        import { FBXLoader } from "https://unpkg.com/three@0.126.1/examples/jsm/loaders/FBXLoader.js";
        const Renderer = new THREE.WebGLRenderer({ canvas: document.querySelector("#Canvas_1"), antialias: true });
        Renderer.setPixelRatio(window.devicePixelRatio);
        Renderer.setSize(window.innerWidth, window.innerHeight);
        Renderer.setClearColor(new THREE.Color(0xFCA3B7));
        const Scene = new THREE.Scene();
        Scene.fog = new THREE.Fog(0xFCA3B7, 0, 10);
        const Loader_FBX = new FBXLoader();
        if (Mobile_or_Desktop())    document.addEventListener('touchstart'  , function () { TouchStart(event); });
        else                        document.addEventListener('mousedown'   , function () { TouchStart(event); });

        // $("#UI_Home_1").click(function () {
        //     window.location.href = '../../English/HTML/index.html';
        // });

        class FC_GameObject {
            Initialize  () {}
            Update      () {}
        }
        class FC_Animation extends FC_GameObject {

            _Flag_Animation = true;
            _Flag_Move      = false;

            constructor() { super(); }

            Update() {
                if ( this._Flag_Animation ) {
                    if ( this._Flag_Move ) {
                        this.Add_Position(this._Move_Direction.clone().multiplyScalar(this._Move_Speed * FC_Environment.TIME_DELTA));
                    }
                }
            }

            Animation_Start () { this._Flag_Animation = true; }
            Animation_Stop  () { this._Flag_Animation = false; }
            Animation_Move  (_vector3, _speed) {
                this._Flag_Move         = true;
                this._Move_Direction    = _vector3;
                this._Move_Speed        = _speed;
            }

            Add_Position(_vector3) {
                throw new Error("Add_Position(_vector3) must be.");
            }
        }
        class FC_Environment extends FC_GameObject {

            static FPS         = 60;
            static TIME_DELTA  = 1 / this.FPS;

            _Gravity    = 9.8;

            get Gravity     () { return this._Gravity; }
            
            set Gravity (_value) { this._Gravity = _value; }

            constructor() { super(); }

            Initialize() {
                this._Gravity    = 9.8;
            }
        }
        class FC_Camera extends FC_GameObject {

            _FOV                    = 100;
            _OFFSET_LOOKAT_DEFAULT  = new THREE.Vector3(0, 0, 1);
            _OFFSET_TARGET_DEFAULT  = new THREE.Vector3(-2, 0.5, -1);

            _Object             = new THREE.PerspectiveCamera(this._FOV, window.innerWidth / window.innerHeight, 0.1, 50);
            _Flag_Target        = false;
            _Target             = null;
            _Position_Offset    = new THREE.Vector3(-2, 0.5, -1);

            get Object          () { return this._Object; }
            get Position        () { return this._Object.position; }
            get Position_Offset () { return this._Position_Offset; }
            get Position_LookAt () { return this._Position_LookAt; }
            get Flag_Target     () { return this._Flag_Target; }
            get Target          () { return this._Target; }

            constructor() { super(); }
            
            set Position(_vector3) { this._Object.position.copy(_vector3); }
            set LookAt  (_vector3) {
                this._Position_LookAt = _vector3;
                this._Object.lookAt(this._Position_LookAt);
            }
            set Target  (_target) {
                if (_target == null) {
                    this._Flag_Target = false;
                }
                else {
                    this._Flag_Target = true;
                }
                this._Target = _target;
            }

            Initialize() {
                this.Position   = this._OFFSET_TARGET_DEFAULT;
                this.LookAt     = this._OFFSET_LOOKAT_DEFAULT;
                this.Target     = null;
            }
            Update() {
                if ( this._Flag_Target ) {
                    this.Position   = new THREE.Vector3(0, 0, this._Target.Position.z).add(this._OFFSET_TARGET_DEFAULT);
                    this.LookAt     = new THREE.Vector3(0, 0, this._Target.Position.z).add(this._OFFSET_LOOKAT_DEFAULT);
                }
            }

            Resize_Screen() {
                Camera.Object.aspect = window.innerWidth / window.innerHeight;
                Camera.Object.updateProjectionMatrix();
                Renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }
        class FC_Light_Ambient extends FC_GameObject {

            _Object = new THREE.AmbientLight(0xffffff, 0.8);
            
            set Color(_color) { this._Object.color.set(_color); }

            constructor () {
                super();
                Scene.add(this._Object);
            }
            destructor  () { Scene.remove(this._Object); }
        }
        class FC_Light_Directional extends FC_GameObject {

            _Object = new THREE.DirectionalLight(0xffffff, 0.8);
            
            set Color(_color) { this._Object.color.set(_color); }

            constructor () {
                super();
                Scene.add(this._Object);
            }
            destructor  () { Scene.remove(this._Object); }
        }
        class FC_Timer extends FC_GameObject {

            _Flag_Starting  = false;
            _Flag_Finished  = false;
            _Time           = 0;
            _Timer          = 0;

            get Flag_Finished() { return this._Flag_Finished; }

            set Time(_second) {
                if ( !this._Flag_Starting ) {
                    this.Initialize();
                    this._Time = _second;
                }
            }

            constructor(_second) {
                super();
                this._Time = _second;
            }

            Initialize() {
                this._Flag_Starting = false;
                this._Flag_Finished = false;
                this._Time          = 0;
                this._Timer         = 0;
            }
            Update() {
                if ( this._Flag_Starting ) {
                    this._Timer += FC_Environment.TIME_DELTA;
                    if (this._Timer > this._Time) {
                        this._Flag_Starting = false;
                        this._Flag_Finished = true;
                        this._Timer         = 0;
                    }
                }
            }

            Start   () { this._Flag_Starting = true; }
            Stop    () { this._Flag_Starting = false;}
            Restart () {
                this._Flag_Finished = false;
                this._Timer = 0;
                this.Start();
            }
        }
        class FC_Audio extends FC_GameObject {
            
            _Audio = new Audio();

            get Flag_Playing() { return !this._Audio.paused; }

            set Volume(_rate) { this._Audio.volume = _rate; }

            constructor(_src, _loop = true, _volume = 0.5) {
                super();
                this._Audio.src = _src;
                this._Audio.loop = _loop;
                this._Audio.volume = _volume;
            }

            Play() {
                this._Audio.play();
            }
            Stop() {
                this._Audio.pause();
                this._Audio.currentTime = 0;
            }
            Restart() {
                this._Audio.currentTime = 0;
                this.Play();
            }
        }
        class FC_TextPlane extends FC_Animation {

            get Mesh    () { return this._Mesh; }
            get Position() { return this._Mesh.position; }
            get Rotation() { return this._Mesh.rotation;}

            set Text(_text) {
                this._Text = _text;
                this._Material.map = this.#_CreateTextTexture(this._Text, this._Color, this._Size_Geometry);
                this._Material.needsUpdate = true;
            }
            set Color(_color) {
                this._Color = _color;
                this._Material.map = this.#_CreateTextTexture(this._Text, this._Color, this._Size_Geometry);
                this._Material.needsUpdate = true;
            }
            set Position(_vector3) { this._Mesh.position.set(_vector3.x, _vector3.y, _vector3.z); }
            set Rotation(_vector3) { this._Mesh.rotation.set(_vector3.x, _vector3.y, _vector3.z); }
            set Scale   (_vector2) { this._Geometry.scale.set(_vector2.x, _vector2.y, 1); }

            constructor(_text, _color, _vector2_geometry, _isbillboard = false) {
                super();
                this._Text_Default  = this._Text    = _text;
                this._Color_Default = this._Color   = _color;
                this._Size_Geometry = _vector2_geometry;
                this._Geometry      = new THREE.PlaneGeometry(_vector2_geometry.x, _vector2_geometry.y);
                this._Material      = new THREE.MeshBasicMaterial({
                                        map: this.#_CreateTextTexture(_text, _color, _vector2_geometry),
                                        side: THREE.DoubleSide,
                                        transparent: true,
                                        opacity: 1.0,
                                        depthTest: false,
                                        depthWrite: false,
                                    });
                this._Mesh          = new THREE.Mesh(this._Geometry, this._Material);
                Scene.add(this._Mesh);

                this._Is_Billboard = _isbillboard;
            }
            destructor() { Scene.remove(this._Mesh); }

            Initialize() {
                this.Position   = new THREE.Vector3(0, 0, 0);
                this.Rotation   = new THREE.Vector3(0, 0, 0);
                this.Text       = this._Text_Default;
                this.Color      = this._Color_Default;
            }
            Update() {
                super.Update();
                if ( this._Is_Billboard ) {
                    LookAt(Camera.Position);
                }
            }

            Show() {
                this._Material.map = this.#_CreateTextTexture(this._Text, Alpha_Change(this._Color, "FF"), this._Size_Geometry);
                this._Material.needsUpdate = true;
            }
            Hide() {
                this._Material.map = this.#_CreateTextTexture(this._Text, Alpha_Change(this._Color, "00"), this._Size_Geometry);
                this._Material.needsUpdate = true;
            }
            Add_Position(_vector3) {
                const new_position = this.Position;
                new_position.x += _vector3.x;
                new_position.y += _vector3.y;
                new_position.z += _vector3.z;
                this.Position = new_position;
            }
            Add_Rotation(_vector3) {
                const new_rotation = this.Rotation;
                new_rotation.x += _vector3.x;
                new_rotation.y += _vector3.y;
                new_rotation.z += _vector3.z;
                this.Rotation = new_rotation;
            }
            LookAt(_vector3) { this._Mesh.lookAt(_vector3); }
            Place_on_Screen(_vector2_screen, _distance) {
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(_vector2_screen, Camera.Object);
                const target_position = new THREE.Vector3();
                this.Position = raycaster.ray.direction.clone().multiplyScalar(_distance).add(Camera.Position);
            }

            #_CreateTextTexture(_text , _color, _vector2_geometry) {
                const canvas    = document.createElement('canvas');
                const context   = canvas.getContext('2d');
                
                const resolution = 512;
                canvas.width    = _vector2_geometry.x * resolution;
                canvas.height   = _vector2_geometry.y * resolution;

                context.fillStyle = '#ffffff00';
                context.fillRect(0, 0, canvas.width, canvas.height);

                const font_size = Math.min(canvas.width, canvas.height);
                context.fillStyle       = _color;
                context.font            = `${font_size}px Arial`;
                context.textAlign       = 'center';
                context.textBaseline    = 'middle';
                context.fillText(_text, canvas.width / 2, canvas.height / 2);

                return new THREE.CanvasTexture(canvas);
            }
        }
        class FC_Manager {

            _List_GameObject = [];
            Add_to_ObjectList(_object) {
                if (_object instanceof FC_GameObject) this._List_GameObject.push(_object);
                else console.error("_object is not FC_GameObject's instance in Add_to_ObjectList()");
            }

            _TIME_FOR_READY = 1;
            _UI_MULTIPLY    = 0.2;

            _State          = "Waiting_Start";
            _Score          = 0;
            _BGM            = new FC_Audio('../../Asset/Audio/lofi_2.wav');

            _Timer_Waiting  = new FC_Timer(1);
            _Timer_Ready    = 0;

            _UI_Home        = new FC_TextPlane("HOME", "#CF0000", new THREE.Vector2(4, 1).multiplyScalar(this._UI_MULTIPLY));
            _UI_Music       = new FC_TextPlane("MUSIC", "#CF0000", new THREE.Vector2(4, 1).multiplyScalar(this._UI_MULTIPLY));
            _UI_Score       = new FC_TextPlane("Score : 0", "#000000", new THREE.Vector2(10, 1).multiplyScalar(this._UI_MULTIPLY));
            _UI_Start       = new FC_TextPlane("START", "#CF0000", new THREE.Vector2(5, 1).multiplyScalar(this._UI_MULTIPLY));
            _UI_Gameover    = new FC_TextPlane("GAMEOVER", "#CF000000", new THREE.Vector2(8, 1).multiplyScalar(this._UI_MULTIPLY));
            _UI_Tap         = new FC_TextPlane("TAP", "#CF000000", new THREE.Vector2(3, 1).multiplyScalar(this._UI_MULTIPLY));

            get UI_Home () { return this._UI_Home; }
            get UI_Music() { return this._UI_Music; }
            get State   () { return this._State; }
            get BGM     () { return this._BGM; }

            Initialize() {
                this._State         = "Waiting";
                this._Score         = 0;

                this._Timer_Waiting.Restart();
                this._Timer_Ready   = 0;

                Cat.Initialize();
                Generator_Bar.Initialize();
                Camera.Initialize();

                Camera.Target = Cat;
                Timer_Input.Start();

                this._UI_Home.Initialize();
                this._UI_Home.Position = new THREE.Vector3(0, 0, -100);
                this._UI_Home.Add_Rotation(new THREE.Vector3(0, Degrees_to_Radians(180), 0));
                this._UI_Music.Initialize();
                this._UI_Music.Position = new THREE.Vector3(0, 0, -100);
                this._UI_Music.Add_Rotation(new THREE.Vector3(0, Degrees_to_Radians(180), 0));
                this._UI_Score.Initialize();
                this._UI_Score.Position = new THREE.Vector3(0, 1, 0.2);
                this._UI_Score.Add_Rotation(new THREE.Vector3(0, Degrees_to_Radians(-90), 0));
                this._UI_Start.Initialize();
                this._UI_Start.Position = new THREE.Vector3(-0.8, 0.5, 1);
                this._UI_Start.Add_Rotation(new THREE.Vector3(0, Degrees_to_Radians(180), 0));
                this._UI_Gameover.Initialize();
                this._UI_Gameover.Position = new THREE.Vector3(0, 0, 0);
                this._UI_Gameover.Add_Rotation(new THREE.Vector3(0, Degrees_to_Radians(180), 0));
                this._UI_Tap.Initialize();
                this._UI_Tap.Position = new THREE.Vector3(-0.8, -0.25, 1);
                this._UI_Tap.Add_Rotation(new THREE.Vector3(0, Degrees_to_Radians(180),  Degrees_to_Radians(180)));
            }
            Update() {
                if ( Cat._Flag_Loaded ) {
                    // for (const object of this._List_GameObject) {
                    //     object.Update();
                    // }

                    switch( this._State ) {
                        case "Waiting":
                            this._Timer_Waiting.Update();
                            if (this._Timer_Waiting.Flag_Finished) {
                                this._State = "Waiting_Start";
                                this._UI_Tap.Show();
                            }
                            break;
                        case "Playing": Manager.Update_Playing(); break;
                    }
                    Manager.Update_System();

                }
                Renderer.render(Scene, Camera.Object);
                requestAnimationFrame(this.Update.bind(this));
            }
            Update_System() {
                
                Timer_Input.Update();

                if (this._State == "Gameover") {
                    this._Timer_Ready += FC_Environment.TIME_DELTA;
                    if (this._Timer_Ready > this._TIME_FOR_READY) {
                        this._State = "Waiting_Restart";
                        this._UI_Tap.Position = new THREE.Vector3(-0.8, -0.25, Camera.Position_LookAt.z);
                    }
                }

                this._UI_Home.Place_on_Screen(new THREE.Vector2(0.6, 0.8), 4);
                this._UI_Music.Place_on_Screen(new THREE.Vector2(0.6, 0.7), 4);
                this._UI_Score.Position = new THREE.Vector3(0, 1, Cat.Position.z + 0.2);
            }
            Update_Playing() {

                Cat.Update();
                Generator_Bar.Update();
                Camera.Update();

                this._UI_Start.Update();
                this._UI_Tap.Update();
                
                this.Add_Score(FC_Environment.TIME_DELTA);
            }

            Start() {
                this._State = "Playing";
                this._UI_Start.Animation_Move(new THREE.Vector3(0, 1, 1), 1);
                this._UI_Tap.Animation_Move(new THREE.Vector3(0, -1, 1), 1);
            }
            GameOver() {
                this._State = "Gameover";
                this._UI_Gameover.Position = new THREE.Vector3(-0.8, 0.5, Camera.Position_LookAt.z);
                this._UI_Gameover.Show();
            }

            Add_Score(_point) {
                this._Score += _point;
                this._UI_Score.Text = "Score : " +  Math.floor(this._Score);
            }
        }

        class C_Cat extends FC_GameObject {
            
            _Flag_Loaded        = false;
            _Flag_Jumping       = false;
            _Flag_Pointed       = false;
            _Jump_Count         = 0;
            _Jump_Timer         = 0;
            _Speed_Past         = 1.2;
            _Speed              = this._Speed_Past;
            _Speed_Acceleration = 1;
            _Jump_Acceleration  = 1.2;
            _Jump_Velocity      = 2.5;
            
            get Flag_Loaded () { return this._Flag_Loaded; }
            get Flag_Jumping() { return this._Flag_Jumping; }
            get Flag_Pointed() { return this._Flag_Pointed; }
            get Position    () { return this._Object.position; }

            set Flag_Pointed(_bool)     { this._Flag_Pointed = _bool; }
            set Position    (_vector3)  { this._Object ? this._Object.position.set(_vector3.x, _vector3.y, _vector3.z) : null; }

            constructor() {
                super();
                this.Initialize();
                Loader_FBX.load(
                    'https://fum0000.github.io/FUM_WebSite/Asset/Model/Cat_1.fbx',
                    (_model) => {
                        _model.scale.set(0.01, 0.01, 0.01);

                        this._AnimationControler = new THREE.AnimationMixer(_model);
                        const action = this._AnimationControler.clipAction(_model.animations[0]);
                        action.play();

                        this._Object = _model;
                        Scene.add(this._Object);

                        this._Flag_Loaded = true;
                    },
                );
            }
            destructor() { Scene.remove(this._Object); }

            Initialize() {
                this._Flag_Jumping          = false;
                this._Jump_Count            = 0;
                this._Jump_Timer            = 0;
                this._Speed_Past            = 1.2;
                this._Speed                 = this._Speed_Past;
                this._Speed_Acceleration    = 1;
                this._Jump_Acceleration     = 1.2;
                this._Jump_Velocity         = 2.5;
                this.Position               = new THREE.Vector3(0, 0, 0);

                if ( this._Flag_Loaded ) {
                    const action = this._AnimationControler.clipAction( this._Object.animations[0]);
                    action.stop();
                    action.reset();
                    action.play();
                }
            }
            Update() {
                this._Speed *= this._Speed_Acceleration;
                this.Move(new THREE.Vector3(0, 0, this._Speed * FC_Environment.TIME_DELTA));
                this.Gravity();
                
                this._AnimationControler.update(0.02);
            }

            Move(_vector3) {
                this._Object.position.add(_vector3);
            }
            Gravity() {
                if ( this._Flag_Jumping ) {
                    this._Jump_Timer += FC_Environment.TIME_DELTA;
                    this.Position = new THREE.Vector3(this.Position.x, this._Jump_Velocity * this._Jump_Timer - 0.5 * Environment.Gravity * this._Jump_Timer * this._Jump_Timer, this.Position.z);

                    if (this.Position.y < 0) {
                        this.Position       = new THREE.Vector3(this.Position.x, 0, this.Position.z);
                        this._Flag_Jumping  = false;
                        this._Flag_Pointed  = false;
                        this._Speed         = this._Speed_Past;
                    }
                }
            }
            Animation_Play(_index) {
                this._AnimationControler.clipAction(this._Object.animations[_index]).play();
            }
            
            Jump() {
                if ( !this._Flag_Jumping ) {
                    this._Flag_Jumping  = true;
                    this._Jump_Count++;
                    this._Jump_Timer    = 0;
                    this._Speed_Past = this._Speed;
                    this._Speed *= this._Jump_Acceleration;
                }
            }
        }
        class C_Generator_Bar extends FC_GameObject {

            _DISTANCE_START     = 10;
            _NUMBER             = 20;
            _NUMBER_TUTORIAL    = 3;

            _List               = [];
            _Distance_Generate  = this._DISTANCE_START;
            _Range_Shortest     = 0.6;
            _Range_Longest      = this._Range_Shortest + 3.0;
            _Point              = 10;
            _Color              = 0xCF0000;

            constructor() {
                super();
                this.#Generate();
            }

            Initialize() {
                this.#Reset();
            }
            Update() {
                this.#Check_Cat();
            }

            #Generate() {
                for (let i = 0; i < this._NUMBER; i++) {
                    const geometry = new THREE.BoxGeometry(1, 1, 1);
                    const material = new THREE.MeshBasicMaterial({ color: this._Color });
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.scale.set(1, 0.1, 0.02);

                    if (i < this._NUMBER_TUTORIAL) {
                        mesh.position.set(0, mesh.scale.y * 0.5, (i + 1) * this._DISTANCE_START);
                        this._List.push(mesh);
                    }
                    else {
                        mesh.position.set(0, mesh.scale.y * 0.5, 0);
                        this._List.push(mesh);
                        this.#Place(i);
                    }

                    Scene.add(mesh);
                }
            }
            #Place(_index) {
                const near = this._Distance_Generate + this._Range_Shortest;
                const far = this._Distance_Generate + this._Range_Longest;
                this._List[_index].position.z = RandomNumber_Between(near, far);
                this._Distance_Generate = this._List[_index].position.z;
            }
            #Reset() {
                this._Distance_Generate = this._NUMBER_TUTORIAL * this._DISTANCE_START;
                for (let i = 0; i < this._NUMBER; i++) {
                    if (i < this._NUMBER_TUTORIAL) {
                        this._List[i].position.set(0, this._List[i].scale.y * 0.5, (i + 1) * this._DISTANCE_START);
                    }
                    else {
                        this._List[i].position.set(0, this._List[i].scale.y * 0.5, 0);
                        this.#Place(i);
                    }
                }
            }

            #Check_Cat() {
                for (let i = 0; i < this._NUMBER; i++) {
                    if (this._List[i].position.z < Cat.Position.z - 10) {
                        this.#Place(i);
                    }
                    if (Cat.Position.z > this._List[i].position.z - 0.2 && Cat.Position.z < this._List[i].position.z + 0.24) {
                        if ( !Cat.Flag_Jumping ) Manager.GameOver();
                        else {
                            if ( !Cat.Flag_Pointed ) {
                                Manager.Add_Score(this._Point);
                                Cat.Flag_Pointed = true;
                            }
                        }
                    }
                }
            }
        }
        class C_Generator_Wall extends FC_GameObject {

            constructor() {
                super();
                for (let i = 0; i < 100; i++) {
                    const geometry = new THREE.BoxGeometry(1, 1, 1);
                    const material = new THREE.MeshBasicMaterial({ color: 0xCFD8DC });
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.scale.set(0.2, 1, 0.5);
                    mesh.position.set(0.5, mesh.scale.y * 0.5, i * 5);
                    Scene.add(mesh);
                }
            }
        }
        
        const Environment       = new FC_Environment();
        const Camera            = new FC_Camera();
        const Light_Ambient     = new FC_Light_Ambient();
        const Light_Directional = new FC_Light_Directional();
        const Timer_Input       = new FC_Timer(0.1);
        const Manager           = new FC_Manager();
        window.addEventListener('resize', Camera.Resize_Screen, false);

        const Cat                 = new C_Cat();
        const Generator_Bar       = new C_Generator_Bar();
        const Generator_Wall      = new C_Generator_Wall();

        Manager.Initialize();
        Manager.Update();

        function TouchStart(event) {
            if ( Timer_Input.Flag_Finished ) {

                let screen_x, screen_y;
                switch( event.type ) {
                    case "touchstart":
                        screen_x = event.touches[0].clientX;
                        screen_y = event.touches[0].clientY;
                        break;
                    case "mousedown":
                        screen_x = event.clientX;
                        screen_y = event.clientY;
                        break;
                }
                
                const screen_position = new THREE.Vector2(
                    (screen_x / window.innerWidth) * 2 - 1,
                    -(screen_y / window.innerHeight) * 2 + 1
                );
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(screen_position, Camera.Object);

                const ui_home = raycaster.intersectObject(Manager.UI_Home.Mesh);
                if (ui_home.length > 0) { window.location.href = "./index.html"; return; }
                const ui_music = raycaster.intersectObject(Manager.UI_Music.Mesh);
                if (ui_music.length > 0) { Manager.BGM.Flag_Playing ? Manager.BGM.Stop() : Manager.BGM.Play(); return; }

                switch(Manager.State) {
                    case "Waiting_Start"    : if ( Cat.Flag_Loaded ) Manager.Start();   break;
                    case "Playing"          : Cat.Jump();                               break;
                    case "Waiting_Restart"  : Manager.Initialize();                     break;
                }
                Timer_Input.Restart();
            }
        }
    </script>

</body>

</html>