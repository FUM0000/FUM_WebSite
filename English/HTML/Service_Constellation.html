<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="author" content="F U M">
    <meta name="description" content="FUM_Website">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B89KY0993B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-B89KY0993B');
    </script>
    <link rel="canonical" href="https://fum0000.github.io/FUM_WebSite/English/HTML/index.html">

    <link rel="icon" type="image/x-icon" href="../../Asset/Image/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../../Asset/Image/Icon_1_2.jpg">
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="../../Asset/CSS/Common.css?v=1.0" rel="stylesheet" />

    <title>Constellation</title>

    <style>
        body {
            width: 0;
            height: 0;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        #App {
            position: relative;
            z-index: 1;
            background-color: transparent !important;
            pointer-events: none;
        }

        #App a,
        #App button,
        #App input,
        #App select,
        #App textarea,
        #App .v-btn,
        #App .v-list-item,
        #App .v-icon {
            pointer-events: auto;
        }

        #controls {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            top: auto;
            width: 100%;
            min-width: 300px;
            max-height: 17vh;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 16px;
            border-radius: 12px 12px 0 0;
            box-sizing: border-box;
            z-index: 100;
            pointer-events: auto;
            transition: max-height 0.25s ease, padding 0.25s ease;
        }

        #controls.collapsed {
            max-height: 3rem;
            padding: 8px 16px;
            overflow-y: hidden;
            /* 閉じているときはスクロール不可 */
        }

        #controls-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        #controls-title {
            font-size: 1rem;
            font-weight: 600;
        }

        #controls-toggle {
            background: transparent;
            border: 1px solid #888;
            color: #fff;
            border-radius: 999px;
            padding: 4px 10px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        #controls-body {
            overflow: hidden;
        }

        /* 閉じているときは中身を非表示にする */
        #controls.collapsed #controls-body {
            display: none;
        }

        /* ラベルをより読みやすく、指でタップしやすく */
        label {
            display: flex;
            flex-direction: column;
            margin: 12px 0;
            font-size: 1.05rem;
        }

        label select,
        label input[type="number"],
        label input[type="date"],
        label input[type="time"] {
            margin-top: 6px;
            padding: 10px 12px;
            font-size: 1.1rem;
            border-radius: 6px;
            border: 1px solid #555;
            background: #111;
            color: white;
            width: 100%;
            box-sizing: border-box;
        }

        /* ボタンも大きく、タップしやすく */
        .button {
            margin-top: 16px;
            padding: 12px 24px;
            font-size: 1.1rem;
            width: 100%;
            background: #555;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* PCでは元の位置に戻したい場合（メディアクエリ） */
        @media (min-width: 768px) {
            #controls {
                position: absolute;
                top: 10px;
                left: 10px;
                bottom: auto;
                right: auto;
                width: auto;
                max-height: none;
                padding: 12px;
                border-radius: 8px;
                background: rgba(0, 0, 0, 0.65);
            }

            /* PC でも閉じているときはスクロールさせない */
            #controls.collapsed {
                max-height: 3rem;
                overflow-y: hidden;
            }

            label {
                display: block;
                margin: 6px 0;
                font-size: 1rem;
            }

            .button {
                width: auto;
                margin-top: 8px;
                padding: 6px 12px;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>

    <canvas id="StarCanvas"></canvas>

    <v-app id="App">
        <template>
            <main-system-bar :drawer="Drawer" @change-drawer="ChangeDrawer">Service > Constellation</main-system-bar>

            <v-main>
                <div id="controls" class="collapsed">
                    <div id="controls-header" onclick="toggleControls()">
                        <span id="controls-title">観測条件</span>
                        <button id="controls-toggle" type="button">開く ▽</button>
                    </div>
                    <div id="controls-body">
                        <label>国:
                            <select id="country" onchange="updateDefaultByCountry()">
                                <option value="JP" selected>日本</option>
                                <option value="US">アメリカ (東部)</option>
                                <option value="GB">イギリス</option>
                                <option value="FR">フランス</option>
                                <option value="DE">ドイツ</option>
                                <option value="AU">オーストラリア (東部)</option>
                                <option value="custom">カスタム</option>
                            </select>
                        </label>

                        <label>緯度 (deg): <input type="number" id="lat" value="35.6895" step="0.1"></label>
                        <label>経度 (deg): <input type="number" id="lon" value="139.6917" step="0.1"></label>
                        <p id="standardMeridian" style="margin:8px 0; font-size:0.9em; color:#aaa;">
                            標準子午線: 135°E (東京)
                        </p>

                        <label>日付: <input type="date" id="date"></label>
                        <label>時間 (現地時): <input type="time" id="time" step="1"></label>
                        <button type="button" class="button" onclick="simulate()">表示更新</button>
                    </div>
                </div>
            </v-main>

            <main-navigation :drawer="Drawer" @change-drawer="ChangeDrawer"></main-navigation>
            <main-footer-simple></main-footer-simple>
        </template>
    </v-app>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="../../Asset/Javascript/Common.js?v=1.03"></script>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.171.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.171.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">

        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // 星のデータ mag<4.5
        const stars = [
            // Orion
            { name: 'Rigel', ra: 78.6339, dec: -8.2016, mag: 0.18, color: '#dbe9ff' }, // B8Ia 青白
            { name: 'Betelgeuse', ra: 88.7934, dec: 7.4070, mag: 0.42, color: '#ffb07a' }, // M2Ib 橙赤
            { name: 'Bellatrix', ra: 81.2829, dec: 6.3497, mag: 1.64, color: '#c9dbff' }, // B2III 青白
            { name: 'Alnilam', ra: 84.0534, dec: -1.2019, mag: 1.69, color: '#a7c8ff' }, // B0Ia 青
            { name: 'Alnitak A', ra: 85.1901, dec: -1.9426, mag: 1.88, color: '#9fc2ff' }, // O9.7Ib 青
            { name: 'Saiph', ra: 86.9391, dec: -9.6696, mag: 2.07, color: '#a7c8ff' }, // B0.5Ia 青
            { name: 'Mintaka AB', ra: 83.0016, dec: -0.2991, mag: 2.20, color: '#a7c8ff' }, // B0III+O9V 青
            { name: 'Iota Ori', ra: 83.8584, dec: -5.9099, mag: 2.75, color: '#9fc2ff' },
            { name: 'Pi3 Ori', ra: 72.4589, dec: 6.9613, mag: 3.19, color: '#fff4ea' }, // F6V 黄白
            { name: 'Eta Ori', ra: 81.1193, dec: -2.3971, mag: 3.35, color: '#bcd3ff' }, // B1V 青白
            { name: 'Meissa A', ra: 83.7845, dec: 9.9342, mag: 3.47, color: '#9bbcff' }, // O8III 青
            { name: 'Tau Ori', ra: 79.4017, dec: -6.8444, mag: 3.59, color: '#d6e4ff' }, // B5III 青白
            { name: 'Pi4 Ori', ra: 72.8015, dec: 5.6051, mag: 3.68, color: '#c9dbff' }, // B2III 青白
            { name: 'Alnitak B', ra: 85.1900, dec: -1.9428, mag: 3.70, color: '#a7c8ff' }, // B0III+B1IV 青
            { name: 'Pi5 Ori', ra: 73.5629, dec: 2.4407, mag: 3.71, color: '#c9dbff' }, // B2III 青白
            { name: 'Sigma Ori AB', ra: 84.6865, dec: -2.6001, mag: 3.77, color: '#9fc2ff' },  // O9.5V 青  // O9III 青
            { name: 'Omicron2 Ori', ra: 74.0929, dec: 13.5146, mag: 4.06, color: '#ffd2a1' }, // K2III 橙
            { name: 'Phi2 Ori', ra: 84.2264, dec: 9.2914, mag: 4.09, color: '#ffe7c2' }, // G8III-IV 黄
            { name: 'Mu Ori', ra: 90.5958, dec: 9.6474, mag: 4.12, color: '#ffffff' }, // Am 白
            { name: '29 Ori', ra: 80.9868, dec: -7.8079, mag: 4.13, color: '#ffe7c2' }, // G8III 黄
            { name: '32 Ori', ra: 82.6960, dec: 5.9482, mag: 4.20, color: '#d6e4ff' }, // B5V 青白
            { name: 'Pi2 Ori', ra: 72.6530, dec: 8.9003, mag: 4.35, color: '#f8fbff' }, // A1V 白
            { name: 'Phi1 Ori', ra: 83.7052, dec: 9.4896, mag: 4.39, color: '#a7c8ff' }, // B0IV 青
            { name: 'Chi1 Ori', ra: 88.5962, dec: 20.2764, mag: 4.39, color: '#fff4ea' }, // G0V 黄白
            { name: 'Nu Ori', ra: 91.8930, dec: 14.7685, mag: 4.42, color: '#c9dbff' }, // B3IV 青白
            { name: 'Xi Ori', ra: 92.9850, dec: 14.2088, mag: 4.45, color: '#c9dbff' }, // B3IV 青白
            { name: 'Rho Ori', ra: 78.3228, dec: 2.8613, mag: 4.46, color: '#ffc78f' }, // K3III 橙
            { name: 'Pi6 Ori', ra: 74.6371, dec: 1.7140, mag: 4.47, color: '#ffd2a1' }, // K2II 橙
            { name: 'Omega Ori', ra: 84.7965, dec: 4.1215, mag: 4.50, color: '#c9dbff' },  // B3IIIe 青白
            // Canis Minor
            { name: 'Procyon', ra: 114.8273, dec: 5.2275, mag: 0.34, color: '#fff4ea' }, // F5IV-V 黄白
            { name: 'Beta CMi', ra: 111.7878, dec: 8.2894, mag: 2.89, color: '#dbe9ff' }, // B8V 青白
            { name: 'Gamma CMi', ra: 112.0410, dec: 8.9255, mag: 4.33, color: '#ffc78f' }, // K3III 橙
            { name: 'HD 66141', ra: 120.5665, dec: 2.3343, mag: 4.39, color: '#ffd2a1' },  // K2III 橙
            // Canis Major
            { name: 'Sirius A', ra: 101.2885, dec: -16.7131, mag: -1.46, color: '#f8fbff' }, // A0 白
            { name: 'Adhara', ra: 104.6565, dec: -28.9721, mag: 1.50, color: '#c9dbff' }, // B2 青白
            { name: 'Wezen', ra: 107.0979, dec: -26.3932, mag: 1.83, color: '#fff2d6' }, // F8 黄白
            { name: 'Mirzam', ra: 95.6749, dec: -17.9559, mag: 1.98, color: '#bcd3ff' }, // B1 青白
            { name: 'Aludra', ra: 111.0238, dec: -29.3031, mag: 2.45, color: '#d6e4ff' }, // B5 青白
            { name: 'Furud', ra: 95.0783, dec: -30.0634, mag: 3.02, color: '#c9dbff' }, // B2.5 青白
            { name: 'Omicron2 CMa', ra: 105.7561, dec: -23.8333, mag: 3.02, color: '#c9dbff' }, // B3 青白
            { name: 'Sigma CMa', ra: 105.4298, dec: -27.9348, mag: 3.49, color: '#ffbf80' }, // K4 橙
            { name: 'Kappa CMa', ra: 102.4603, dec: -32.5085, mag: 3.50, color: '#bcd3ff' }, // B1.5 青白
            { name: 'Omicron1 CMa', ra: 103.5331, dec: -24.1842, mag: 3.89, color: '#ffc78f' }, // K3 橙
            { name: 'Nu2 CMa', ra: 99.1708, dec: -19.2557, mag: 3.95, color: '#ffd8a8' }, // K1 橙
            { name: 'Omega CMa', ra: 108.7028, dec: -26.7727, mag: 4.01, color: '#c9dbff' }, // B2 青白
            { name: 'Theta CMa', ra: 103.5478, dec: -12.0386, mag: 4.08, color: '#ffbf80' }, // K4 橙
            { name: 'Gamma CMa', ra: 105.9395, dec: -15.6333, mag: 4.12, color: '#dbe9ff' }, // B8 青白
            { name: 'Xi1 CMa', ra: 97.9640, dec: -23.4184, mag: 4.34, color: '#bcd3ff' }, // B1 青白
            { name: 'Iota CMa', ra: 104.0343, dec: -17.0543, mag: 4.36, color: '#c9dbff' }, // B3 青白
            { name: 'Tau CMa', ra: 109.6770, dec: -24.9544, mag: 4.37, color: '#9bbcff' }, // O9 青
            { name: 'Nu3 CMa', ra: 99.4726, dec: -18.2374, mag: 4.42, color: '#ffe2b5' }, // K0 黄橙
            { name: '27 CMa', ra: 108.5634, dec: -26.3525, mag: 4.42, color: '#c9dbff' }, // B3 青白
            { name: 'Lambda CMa', ra: 97.0426, dec: -32.5801, mag: 4.47, color: '#d6e4ff' }, // B4 青白
            // Gemini
            { name: 'Pollux', ra: 116.3307, dec: 28.0263, mag: 1.16, color: '#ffe2b5' }, // K0III 橙
            { name: 'Castor A', ra: 113.6500, dec: 31.8886, mag: 1.90, color: '#f8fbff' }, // A2 白
            { name: 'Gamma Gem', ra: 99.4279, dec: 16.3994, mag: 1.93, color: '#f8fbff' }, // A0 白
            { name: 'Mu Gem', ra: 95.7399, dec: 22.5139, mag: 2.87, color: '#ffb07a' }, // M3 赤橙
            { name: 'Castor B', ra: 113.6500, dec: 31.8886, mag: 2.88, color: '#ffffff' }, // Am 白
            { name: 'Epsilon Gem', ra: 100.9830, dec: 25.1312, mag: 3.06, color: '#ffe7c2' }, // G8 黄
            { name: 'Eta Gem', ra: 93.7196, dec: 22.5068, mag: 3.31, color: '#ffb07a' }, // M3 赤橙
            { name: 'Xi Gem', ra: 101.3226, dec: 12.8961, mag: 3.35, color: '#fff4ea' }, // F5 黄白
            { name: 'Delta Gem', ra: 110.0308, dec: 21.9823, mag: 3.50, color: '#fdfcff' }, // F0 白
            { name: 'Kappa Gem', ra: 116.1119, dec: 24.3981, mag: 3.57, color: '#ffe7c2' }, // G8 黄
            { name: 'Lambda Gem', ra: 109.5234, dec: 16.5405, mag: 3.58, color: '#f8fbff' }, // A3 白
            { name: 'Theta Gem', ra: 103.1973, dec: 33.9614, mag: 3.60, color: '#f8fbff' }, // A3 白
            { name: 'Iota Gem', ra: 111.4320, dec: 27.7983, mag: 3.78, color: '#ffe2b5' }, // G9 黄橙
            { name: 'Zeta Gem', ra: 106.0273, dec: 20.5703, mag: 4.01, color: '#fff4ea' }, // G1 黄白
            { name: 'Upsilon Gem', ra: 113.9807, dec: 26.8960, mag: 4.06, color: '#ffc78f' }, // K5 橙
            { name: 'Nu Gem A', ra: 97.2408, dec: 20.2122, mag: 4.13, color: '#d6e4ff' }, // B6 青白
            { name: '1 Gem', ra: 91.0301, dec: 23.2636, mag: 4.16, color: '#ffe7c2' }, // G7 黄
            { name: 'Rho Gem', ra: 112.2775, dec: 31.7841, mag: 4.16, color: '#fdfcff' }, // F0 白
            { name: 'Sigma Gem', ra: 115.8280, dec: 28.8841, mag: 4.23, color: '#ffd8a8' }, // K1 橙
            { name: 'Tau Gem', ra: 107.7850, dec: 30.2453, mag: 4.41, color: '#ffd2a1' }, // K2 橙
            { name: '30 Gem', ra: 100.9970, dec: 13.2281, mag: 4.49, color: '#ffd8a8' }, // K1 橙
            // Taurus
            { name: 'Aldebaran', ra: 68.9800, dec: 16.5098, mag: 0.87, color: '#ffb26b' }, // K5III 橙赤
            { name: 'Beta Tau', ra: 81.5729, dec: 28.6079, mag: 1.65, color: '#c9d9ff' }, // B7 青白
            { name: 'Alcyone A', ra: 56.8711, dec: 24.1053, mag: 2.85, color: '#c9d9ff' }, // B7 青白
            { name: 'Zeta Tau', ra: 84.4112, dec: 21.1426, mag: 2.97, color: '#bcd0ff' }, // B4 青
            { name: 'Theta2 Tau', ra: 67.1653, dec: 15.8709, mag: 3.40, color: '#f8fbff' }, // A7 白
            { name: 'Lambda Tau', ra: 60.1701, dec: 12.4904, mag: 3.41, color: '#b5c7ff' }, // B3 青
            { name: 'Epsilon Tau', ra: 67.1539, dec: 19.1805, mag: 3.53, color: '#ffe2b5' }, // K0 黄橙
            { name: 'Omicron Tau', ra: 51.2035, dec: 9.0291, mag: 3.61, color: '#ffe7c2' }, // G8 黄
            { name: 'Atlas A', ra: 57.2905, dec: 24.0535, mag: 3.62, color: '#d6e4ff' }, // B8 青白
            { name: 'Gamma Tau', ra: 64.9480, dec: 15.6277, mag: 3.65, color: '#ffe7c2' }, // G8 黄
            { name: 'Electra', ra: 56.2188, dec: 24.1134, mag: 3.72, color: '#d0dcff' }, // B6 青白
            { name: 'Xi Tau', ra: 51.7922, dec: 9.7328, mag: 3.73, color: '#e0e8ff' }, // B9 青白
            { name: 'Delta1 Tau', ra: 65.7335, dec: 17.5426, mag: 3.77, color: '#ffe7c2' }, // G8 黄
            { name: 'Theta1 Tau', ra: 67.1435, dec: 15.9622, mag: 3.84, color: '#ffe7c2' }, // G7 黄
            { name: 'Maia', ra: 56.4566, dec: 24.3679, mag: 3.87, color: '#d6e4ff' }, // B8 青白
            { name: 'Nu Tau', ra: 60.7891, dec: 5.9893, mag: 3.91, color: '#f8fbff' }, // A1 白
            { name: '5 Tau', ra: 52.7182, dec: 12.9367, mag: 4.14, color: '#ffd8a8' }, // K0 橙
            { name: 'Merope', ra: 56.5815, dec: 23.9485, mag: 4.14, color: '#d0dcff' }, // B6 青白
            { name: 'Kappa1 Tau', ra: 66.3421, dec: 22.2939, mag: 4.21, color: '#f8fbff' }, // A7 白
            { name: '88 Tau', ra: 68.9135, dec: 10.1609, mag: 4.25, color: '#f8fbff' }, // A5 白
            { name: 'Mu Tau', ra: 63.8835, dec: 8.8924, mag: 4.27, color: '#b5c7ff' }, // B3 青
            { name: '90 Tau', ra: 69.5392, dec: 12.5109, mag: 4.27, color: '#ffffff' }, // A6 白
            { name: 'Tau Tau', ra: 70.5613, dec: 22.9569, mag: 4.27, color: '#b5c7ff' }, // B3 青
            { name: 'Upsilon Tau', ra: 66.5766, dec: 22.8137, mag: 4.28, color: '#ffffff' }, // A8 白
            { name: '10 Tau', ra: 54.2188, dec: 0.4028, mag: 4.29, color: '#fff4ea' }, // F9 黄白
            { name: 'Taygeta', ra: 56.3020, dec: 24.4674, mag: 4.30, color: '#d0dcff' }, // B6 青白
            { name: '68 Tau', ra: 66.3722, dec: 17.9280, mag: 4.30, color: '#f8fbff' }, // A2 白
            { name: '119 Tau', ra: 83.0531, dec: 18.5943, mag: 4.32, color: '#ff9b5a' }, // M2 赤
            { name: '37 Tau', ra: 61.1736, dec: 22.0821, mag: 4.36, color: '#ffe2b5' }, // K0 黄橙
            { name: '71 Tau', ra: 66.5861, dec: 15.6183, mag: 4.48, color: '#fdfcff' }, // F0 白
            // Auriga
            { name: 'Capella', ra: 79.1721, dec: 45.9990, mag: 0.08, color: '#ffe7c2' }, // G8III/G0III 黄
            { name: 'Beta Aur', ra: 89.8824, dec: 44.9474, mag: 1.90, color: '#f8fbff' }, // A2 白
            { name: 'Theta Aur', ra: 89.9302, dec: 37.2128, mag: 2.62, color: '#f0f6ff' }, // A0 白青
            { name: 'Iota Aur', ra: 74.2484, dec: 33.1661, mag: 2.69, color: '#ffb26b' }, // K3 橙
            { name: 'Epsilon Aur', ra: 75.4922, dec: 43.8233, mag: 3.03, color: '#fff4ea' }, // F0 黄白
            { name: 'Eta Aur', ra: 76.6286, dec: 41.2346, mag: 3.18, color: '#b5c7ff' }, // B3 青
            { name: 'Zeta Aur', ra: 75.6195, dec: 41.0759, mag: 3.69, color: '#ffb26b' }, // K4 橙
            { name: 'Delta Aur', ra: 89.8815, dec: 54.2849, mag: 3.72, color: '#ffe2b5' }, // K0 黄橙
            { name: 'Nu Aur', ra: 87.8725, dec: 39.1485, mag: 3.97, color: '#ffe2b5' }, // K0 黄橙
            { name: 'Pi Aur', ra: 89.9838, dec: 45.9368, mag: 4.30, color: '#ff9b5a' }, // M3 赤橙
            { name: 'Kappa Aur', ra: 93.8448, dec: 29.4987, mag: 4.32, color: '#ffe7c2' }, // G8 黄
            // Lepus
            { name: 'Alpha Lep', ra: 83.1825, dec: -17.8223, mag: 2.58, color: '#fff4ea' }, // F0Ib 黄白
            { name: 'Beta Lep', ra: 82.0614, dec: -20.7592, mag: 2.81, color: '#ffe7c2' }, // G5 黄
            { name: 'Epsilon Lep', ra: 76.3652, dec: -22.3709, mag: 3.19, color: '#ffb26b' }, // K4 橙
            { name: 'Mu Lep', ra: 78.2328, dec: -16.2054, mag: 3.29, color: '#f8fbff' }, // B9 青白
            { name: 'Zeta Lep', ra: 86.7389, dec: -14.8219, mag: 3.55, color: '#f8fbff' }, // A2 白
            { name: 'Gamma Lep', ra: 86.1165, dec: -22.4475, mag: 3.59, color: '#fff8ef' }, // F7 黄白
            { name: 'Eta Lep', ra: 89.1013, dec: -14.1680, mag: 3.71, color: '#f6faff' }, // F1 白寄り
            { name: 'Delta Lep', ra: 87.8298, dec: -20.8775, mag: 3.76, color: '#ffe2b5' }, // G8 黄橙
            { name: 'Lambda Lep', ra: 79.8939, dec: -13.1768, mag: 4.29, color: '#9db4ff' }, // B0.5 青
            { name: 'Kappa Lep', ra: 78.3079, dec: -12.9413, mag: 4.36, color: '#c9d7ff' }, // B7 青白
            { name: 'Iota Lep', ra: 78.0745, dec: -11.8691, mag: 4.45, color: '#d6e0ff' }, // B8 青白
            // Cancer
            { name: 'Beta Cnc', ra: 124.1290, dec: 9.1857, mag: 3.53, color: '#ffb26b' }, // K4III 橙
            { name: 'Delta Cnc', ra: 131.1713, dec: 18.1549, mag: 3.94, color: '#ffc78a' }, // K0III 黄橙
            { name: 'Iota Cnc A', ra: 131.6743, dec: 28.7600, mag: 4.03, color: '#ffe2b5' }, // G8III 黄
            { name: 'Alpha Cnc', ra: 134.6217, dec: 11.8578, mag: 4.26, color: '#f8fbff' }, // A5m 白
            { name: 'Gamma Cnc', ra: 130.8217, dec: 21.4686, mag: 4.66, color: '#f8fbff' }, // A1IV 白
            { name: 'Zeta Cnc', ra: 123.0529, dec: 17.6481, mag: 4.67, color: '#fff4d6' }, // F7–G0 黄白（多重星）
            // Perseus
            { name: 'Alpha Per', ra: 51.0806, dec: 49.8613, mag: 1.79, color: '#fff6e0' }, // F5Ib 黄白
            { name: 'Algol', ra: 47.0422, dec: 40.9556, mag: 2.09, color: '#dbe9ff' }, // B8V 青白
            { name: 'Zeta Per', ra: 58.5330, dec: 31.8837, mag: 2.84, color: '#cfe0ff' }, // B1Ib 青白
            { name: 'Epsilon Per', ra: 59.4634, dec: 40.0103, mag: 2.90, color: '#c8dcff' }, // B0.5V 青白
            { name: 'Gamma Per A', ra: 46.1991, dec: 53.5064, mag: 2.91, color: '#ffd59b' }, // G8III 橙黄
            { name: 'Gamma Per B', ra: 46.1838, dec: 53.5194, mag: 3.00, color: '#ffffff' }, // 色不明 → 白
            { name: 'Delta Per', ra: 55.7312, dec: 47.7877, mag: 3.01, color: '#e2ecff' }, // B5III 青白
            { name: 'Rho Per', ra: 46.2938, dec: 38.8405, mag: 3.32, color: '#ff9b5e' }, // M3III 赤橙
            { name: 'Eta Per', ra: 42.6741, dec: 55.8955, mag: 3.77, color: '#ffb46e' }, // K3Ib 橙
            { name: 'Nu Per', ra: 56.2985, dec: 42.5786, mag: 3.77, color: '#fff6e0' }, // F5II 黄白
            { name: 'Kappa Per', ra: 47.3735, dec: 44.8579, mag: 3.79, color: '#ffc78a' }, // K0III 橙黄
            { name: 'Omicron Per', ra: 56.0797, dec: 32.2883, mag: 3.84, color: '#cfe0ff' }, // B1III 青白
            { name: 'Tau Per A', ra: 43.5644, dec: 52.7625, mag: 3.93, color: '#ffe9c7' }, // G4III 黄
            { name: '48 Per', ra: 62.1653, dec: 47.7126, mag: 3.96, color: '#d8e6ff' }, // B3Ve 青白
            { name: 'Xi Per', ra: 59.7413, dec: 35.7910, mag: 3.98, color: '#c6d8ff' }, // O7.5I 青
            { name: 'Tau Per B', ra: 43.5867, dec: 52.7583, mag: 4.00, color: '#ffffff' }, // 色不明
            { name: 'Phi Per', ra: 25.9151, dec: 50.6888, mag: 4.01, color: '#dbe7ff' }, // B2V 青白
            { name: 'Iota Per', ra: 47.2620, dec: 49.6135, mag: 4.05, color: '#fff2cc' }, // G0V 黄
            { name: 'Theta Per', ra: 41.0487, dec: 49.2287, mag: 4.10, color: '#fff6e0' }, // F7V 黄白
            { name: 'Mu Per', ra: 63.7244, dec: 48.4094, mag: 4.12, color: '#fff2cc' }, // G0Ib 黄
            { name: '16 Per', ra: 42.6455, dec: 38.3189, mag: 4.22, color: '#fff6e0' }, // F2III 黄白
            { name: 'Lambda Per', ra: 61.6461, dec: 50.3514, mag: 4.25, color: '#f2f6ff' }, // A0IV 白
            { name: '58 Per', ra: 69.1726, dec: 41.2649, mag: 4.25, color: '#ffe2b5' }, // G8II 黄
            { name: 'Psi Per', ra: 54.1223, dec: 48.1927, mag: 4.32, color: '#e2ecff' }, // B5Ve 青白
            { name: 'Sigma Per', ra: 52.6437, dec: 47.9952, mag: 4.36, color: '#ffb26b' }, // K3III 橙
            // Cassiopeia
            { name: 'Alpha Cas', ra: 10.1266, dec: 56.5374, mag: 2.24, color: '#ffc78a' }, // K0II-III 橙黄
            { name: 'Beta Cas', ra: 2.2920, dec: 59.1502, mag: 2.28, color: '#fff6e0' }, // F2III-IV 黄白
            { name: 'Gamma Cas', ra: 14.1771, dec: 60.7168, mag: 2.47, color: '#c6d8ff' }, // B0IV 青白
            { name: 'Delta Cas', ra: 21.4525, dec: 60.2354, mag: 2.68, color: '#f8fbff' }, // A5V 白
            { name: 'Epsilon Cas', ra: 28.5987, dec: 63.6701, mag: 3.35, color: '#dbe7ff' }, // B2 青白
            { name: 'Eta Cas', ra: 12.2713, dec: 57.8166, mag: 3.46, color: '#fff2cc' }, // G0V 黄
            { name: 'Zeta Cas', ra: 9.2428, dec: 53.8969, mag: 3.69, color: '#dbe7ff' }, // B2IV 青白
            { name: '50 Cas', ra: 30.8591, dec: 72.4213, mag: 3.95, color: '#f8fbff' }, // A2V 白
            { name: 'Kappa Cas', ra: 8.2499, dec: 62.9318, mag: 4.17, color: '#c6d8ff' }, // B1Ia 青白
            { name: 'Theta Cas', ra: 17.7747, dec: 55.1499, mag: 4.34, color: '#f8fbff' }, // A7V 白
            { name: 'Iota Cas', ra: 37.2666, dec: 67.4024, mag: 4.46, color: '#f8fbff' }, // A5p 白
            { name: 'Omicron Cas', ra: 11.1813, dec: 48.2844, mag: 4.48, color: '#e2ecff' }, // B5III 青白
            { name: '48 Cas', ra: 30.4898, dec: 70.9071, mag: 4.49, color: '#f8fbff' }, // A3IV 白
            // Andromeda
            { name: 'Alpheratz (Alpha And)', ra: 2.0965, dec: 29.0908, mag: 2.07, color: '#e6ecff' }, // B9 青白
            { name: 'Mirach (Beta And)', ra: 17.4325, dec: 35.6208, mag: 2.07, color: '#ffb07a' }, // M0 赤橙
            { name: 'Gamma1 And (Almach)', ra: 30.9747, dec: 42.3299, mag: 2.10, color: '#ffd2a1' }, // K3 橙
            { name: 'Delta And', ra: 9.8317, dec: 30.8612, mag: 3.27, color: '#ffd2a1' }, // K3 橙
            { name: 'M31 (Andromeda Galaxy)', ra: 10.6846, dec: 41.2693, mag: 3.44, color: '#cccccc' }, // 銀河（灰色扱い）
            { name: '51 And (Nembus)', ra: 24.4979, dec: 48.6285, mag: 3.59, color: '#ffd2a1' }, // K3 橙
            { name: 'Omicron And', ra: 345.4802, dec: 42.3259, mag: 3.62, color: '#dbe7ff' }, // B6 青白
            { name: 'Lambda And', ra: 354.3905, dec: 46.4592, mag: 3.81, color: '#ffe7b5' }, // G8 黄橙
            { name: 'Mu And', ra: 14.1879, dec: 38.4993, mag: 3.86, color: '#f8fbff' }, // A5 白
            { name: 'Zeta And', ra: 11.8350, dec: 24.2674, mag: 4.08, color: '#ffc78a' }, // K1 橙
            { name: 'Upsilon And (Titawin)', ra: 24.1999, dec: 41.4064, mag: 4.10, color: '#fff6e0' }, // F8 黄白
            { name: 'Kappa And', ra: 355.1018, dec: 44.3340, mag: 4.15, color: '#e6ecff' }, // B9 青白
            { name: 'Phi And', ra: 17.3755, dec: 47.2418, mag: 4.26, color: '#dbe7ff' }, // B7 青白
            { name: 'Iota And', ra: 354.5341, dec: 43.2681, mag: 4.29, color: '#e6ecff' }, // B8 青白
            { name: 'Pi And', ra: 9.2202, dec: 33.7194, mag: 4.34, color: '#dbe7ff' }, // B5 青白
            { name: 'Epsilon And', ra: 9.6396, dec: 29.3124, mag: 4.34, color: '#ffe7b5' }, // G5 黄
            { name: 'Eta And', ra: 14.3018, dec: 23.4178, mag: 4.40, color: '#ffe7b5' }, // G8 黄橙
            // 
        ];

        let scene, camera, renderer, controls, composer;
        let bloomPass;

        // 国ごとのデフォルト設定（東京に変更済み）
        const countryDefaults = {
            JP: { lat: 35.6895, lon: 139.6917, name: "東京", stdMeridian: 135, tzOffset: 9 },
            US: { lat: 40.71, lon: -74.01, name: "ニューヨーク", stdMeridian: -75, tzOffset: -5 },
            GB: { lat: 51.51, lon: -0.13, name: "ロンドン", stdMeridian: 0, tzOffset: 0 },
            FR: { lat: 48.86, lon: 2.35, name: "パリ", stdMeridian: 15, tzOffset: 1 },
            DE: { lat: 52.52, lon: 13.41, name: "ベルリン", stdMeridian: 15, tzOffset: 1 },
            AU: { lat: -33.87, lon: 151.21, name: "シドニー", stdMeridian: 150, tzOffset: 11 }, // 2026年1月は夏時間
            custom: { lat: 35.0, lon: 135.0, name: "カスタム", stdMeridian: null, tzOffset: 9 }
        };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x00050a);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
            camera.position.set(0.8, 0.3, 0.8);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, canvas: document.getElementById('StarCanvas') });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // ── Post Processing ──
            composer = new EffectComposer(renderer);
            const renderPass = new RenderPass(scene, camera);
            composer.addPass(renderPass);

            bloomPass = new UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                0.5,    // strength
                0.5,    // radius
                1       // threshold ← 暗い星はほとんど光らない
            );
            composer.addPass(bloomPass);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.06;
            controls.rotateSpeed = 0.55;
            controls.enableZoom = false;
            controls.enablePan = false;
            controls.enableRotate = true;
            camera.fov = 90;
            camera.updateProjectionMatrix();
            function handleZoom(delta) {
                // delta > 0 → ズームアウト（視野角大きく）
                // delta < 0 → ズームイン（視野角小さく）
                const zoomFactor = 1 + delta * 0.0008;
                camera.fov = THREE.MathUtils.clamp(
                    camera.fov * zoomFactor,
                    10,
                    120
                );
                camera.updateProjectionMatrix();
            }
            // マウスホイール
            renderer.domElement.addEventListener('wheel', (event) => {
                event.preventDefault();
                handleZoom(event.deltaY);
            }, { passive: false });
            // ピンチ
            let lastTouchDistance = null;
            let isPinching = false;
            renderer.domElement.addEventListener(
                'touchstart',
                (event) => {
                    if (event.touches.length === 2) {
                        const dx =
                            event.touches[0].clientX -
                            event.touches[1].clientX;
                        const dy =
                            event.touches[0].clientY -
                            event.touches[1].clientY;

                        lastTouchDistance = Math.hypot(dx, dy);
                        isPinching = true;

                        controls.enableRotate = false;
                    }
                },
                { passive: false }
            );
            renderer.domElement.addEventListener(
                'touchmove',
                (event) => {
                    if (event.touches.length !== 2 || !isPinching) return;

                    event.preventDefault();

                    const dx =
                        event.touches[0].clientX -
                        event.touches[1].clientX;
                    const dy =
                        event.touches[0].clientY -
                        event.touches[1].clientY;

                    const currentDistance = Math.hypot(dx, dy);
                    const delta = lastTouchDistance - currentDistance;

                    if (Math.abs(delta) > 0.5) {
                        handleZoom(delta * 10);
                        lastTouchDistance = currentDistance;
                    }
                },
                { passive: false }
            );
            renderer.domElement.addEventListener(
                'touchend',
                (event) => {
                    if (event.touches.length < 2) {
                        lastTouchDistance = null;
                        isPinching = false;

                        controls.enableRotate = true;
                    }
                },
                { passive: false }
            );

            window.addEventListener('resize', onWindowResize);
            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            composer.render();
        }

        // 以下は元のコードとほぼ同じ（緯度経度・時間計算部分）
        function degToRad(deg) { return deg * Math.PI / 180; }

        function JulianDateFromUnixTime(t) {
            return (t / 86400000) + 2440587.5;
        }

        function greenwichMeanSiderealTime(jd) {
            const t = (jd - 2451545.0) / 36525.0;
            let gmst = 280.46061837 + 360.98564736629 * (jd - 2451545.0) + 0.000387933 * t * t - t * t * t / 38710000;
            gmst = (gmst % 360 + 360) % 360;
            return degToRad(gmst);
        }

        function raDecToAltAz(ra, dec, lat, lon, jd) {
            const gmst = greenwichMeanSiderealTime(jd);
            let lst = gmst + lon;
            let ha = lst - ra;

            ha = ((ha % (2 * Math.PI)) + 2 * Math.PI) % (2 * Math.PI);
            if (ha > Math.PI) ha -= 2 * Math.PI;

            const sinAlt = Math.sin(lat) * Math.sin(dec) + Math.cos(lat) * Math.cos(dec) * Math.cos(ha);
            const alt = Math.asin(sinAlt);

            let az = Math.atan2(
                Math.sin(ha) * Math.cos(dec),
                Math.cos(ha) * Math.sin(lat) * Math.cos(dec) - Math.sin(dec) * Math.cos(lat)
            );
            az = (az + 2 * Math.PI) % (2 * Math.PI);

            return { az, alt };
        }

        window.updateDefaultByCountry = function () {
            const country = document.getElementById('country').value;
            const def = countryDefaults[country] || countryDefaults.custom;
            document.getElementById('lat').value = def.lat.toFixed(4);
            document.getElementById('lon').value = def.lon.toFixed(4);
            document.getElementById('standardMeridian').textContent =
                def.stdMeridian !== null
                    ? `標準子午線: ${Math.abs(def.stdMeridian)}°${def.stdMeridian >= 0 ? 'E' : 'W'}`
                    : `標準子午線: --- (カスタム)`;
        };

        // コントロールの開閉
        window.toggleControls = function () {
            const container = document.getElementById('controls');
            const toggleBtn = document.getElementById('controls-toggle');

            const isCollapsed = container.classList.contains('collapsed');
            if (isCollapsed) {
                container.classList.remove('collapsed');
                toggleBtn.textContent = '閉じる △';
            } else {
                container.classList.add('collapsed');
                toggleBtn.textContent = '開く ▽';
            }
        };

        // 現在の日時を入力欄にセット（日本時間）
        function setCurrentDateTime() {
            const now = new Date();
            // 日本時間に強制（tzOffset=9）
            const jpTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (9 * 3600000));

            const dateStr = jpTime.toISOString().split('T')[0];
            const timeStr = jpTime.toTimeString().slice(0, 5);

            document.getElementById('date').value = dateStr;
            document.getElementById('time').value = timeStr;
        }

        // 16進数をRGBに変換するヘルパー
        function hexToRgb(hex) {
            hex = hex.replace('#', '');
            const bigint = parseInt(hex, 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }

        // ── 暖色（赤・オレンジ・黄系）かどうかを判定 ──
        function isWarmColor(hex) {
            const { r, g, b } = hexToRgb(hex);

            // 基本条件：赤成分がかなり強い
            if (r < 180) return false;  // 赤が弱い → 冷色寄り

            // 暖色判定のメイン条件（以下のいずれかを満たせば暖色）
            const conditions = [
                // 強い赤～赤橙（Betelgeuse, Antares系）
                r > 210 && g < 100 && b < 100,

                // オレンジ～黄橙（Aldebaran, Pollux, Arcturus系）
                r > 210 && g > 120 && g < 200 && b < 140,

                // 淡いオレンジ・黄味がかった白（Arcturus, Menkalinan系）
                r > 230 && g > 180 && b < 160 && (r - g) < 70,

                // 赤みが強いが少し青を含む場合も救済（自然な暖色範囲）
                r > g * 1.35 && r > b * 1.4 && (g + b > 100)
            ];

            return conditions.some(cond => cond === true);
        }

        window.simulate = function () {
            const latDeg = parseFloat(document.getElementById('lat').value) || 35;
            const lonDeg = parseFloat(document.getElementById('lon').value) || 135;
            const dateStr = document.getElementById('date').value;
            const timeStr = document.getElementById('time').value;

            if (!dateStr || !timeStr) return;

            const country = document.getElementById('country').value;
            const tzOffset = countryDefaults[country]?.tzOffset ?? 9;

            const [year, month, day] = dateStr.split('-').map(Number);
            const [hour, min] = timeStr.split(':').map(Number);

            const localDate = new Date(Date.UTC(year, month - 1, day, hour, min, 0));
            const utcDate = new Date(localDate.getTime() - tzOffset * 3600000);
            const jd = JulianDateFromUnixTime(utcDate.getTime());

            const lat = degToRad(latDeg);
            const lon = degToRad(lonDeg);

            // 古い星を削除
            scene.children.forEach(child => {
                if (child.type === 'Points') {
                    scene.remove(child);
                    child.geometry?.dispose();
                    child.material?.dispose();
                }
            });

            const positions = [];
            const colors = [];
            const sizes = [];

            stars.forEach(star => {
                const raRad = degToRad(star.ra);
                const decRad = degToRad(star.dec);

                const { az, alt } = raDecToAltAz(raRad, decRad, lat, lon, jd);

                // if (alt <= 0) return; // 地平線以下は非表示

                const theta = Math.PI / 2 - alt;
                const phi = az;

                const radius = 600;
                const x = radius * Math.sin(theta) * Math.cos(phi);
                const z = radius * Math.sin(theta) * Math.sin(phi);
                const y = radius * Math.cos(theta);

                // サイズ計算 star.mag=-1.0~4.5のときsize=2.0~10.0になる補正式
                let size = (4 / 3) * (6.0 - star.mag);

                positions.push(x, y, z);

                // 明るさ（発光強度）を色に反映
                const col = new THREE.Color(star.color);

                // 色温度的な暖色系（赤・オレンジ）を少し強く光らせる補正
                const warmBoost = isWarmColor(star.color) ? 2.0 : 1.0;
                const baseBrightness = (4 / 3) * (6.0 - star.mag) * 0.5;
                const brightness = baseBrightness * warmBoost;
                col.multiplyScalar(brightness);

                colors.push(col.r, col.g, col.b);
                sizes.push(size);
            });

            if (positions.length === 0) return;

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));

            // カスタムシェーダーで個別サイズをサポート
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    scale: { value: window.innerHeight / 2 }
                },
                vertexShader: `
                    attribute float size;
                    varying vec3 vColor;

                    void main() {
                        vColor = color;
                        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                        gl_PointSize = size * (300.0 / -mvPosition.z); // 遠近法調整
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `,
                fragmentShader: `
                    varying vec3 vColor;
                    void main() {
                        vec2 coord = gl_PointCoord - vec2(0.5);
                        float dist = length(coord);
                        if (dist > 0.49) discard;           // より厳密な円形
                        float alpha = 1.0 - smoothstep(0.40, 0.49, dist); // 柔らかい縁
                        gl_FragColor = vec4(vColor, alpha);
                    }
                `,
                vertexColors: true,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthTest: false,
                depthWrite: false
            });

            const points = new THREE.Points(geometry, material);
            scene.add(points);
        }

        // 初期化＆初回表示
        init();
        window.addEventListener('DOMContentLoaded', () => {
            updateDefaultByCountry();
            setCurrentDateTime();
            simulate();
        });

        window.vue = new Vue({
            el: '#App',
            vuetify: new Vuetify(),
            mixins: [window.Mixins_Common]
        });

    </script>
</body>

</html>