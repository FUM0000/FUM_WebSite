<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="author" content="F U M">
    <meta name="description" content="FUM_Website">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B89KY0993B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-B89KY0993B');
    </script>
    <link rel="canonical" href="https://fum0000.github.io/FUM_WebSite/English/HTML/index.html">

    <link rel="icon" type="image/x-icon" href="../../Asset/Image/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../../Asset/Image/Icon_1_2.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="../../Asset/CSS/Common.css?v=1.0" rel="stylesheet" />

    <title>Constellation</title>

    <style>
        body {
            margin: 0;
            background: #000;
            overflow: hidden;
            font-family: Arial, Helvetica, sans-serif;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        #App {
            position: relative;
            z-index: 1;
            background-color: transparent !important;
            pointer-events: none;
        }

        #App a,
        #App button,
        #App input,
        #App select,
        #App textarea,
        #App .v-btn,
        #App .v-list-item,
        #App .v-icon {
            pointer-events: auto;
        }

        #controls {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            top: auto;
            width: 100%;
            max-height: 17vh;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 16px;
            border-radius: 12px 12px 0 0;
            box-sizing: border-box;
            z-index: 100;
            pointer-events: auto;
        }

        /* ラベルをより読みやすく、指でタップしやすく */
        label {
            display: flex;
            flex-direction: column;
            margin: 12px 0;
            font-size: 1.05rem;
        }

        label select,
        label input[type="number"],
        label input[type="date"],
        label input[type="time"] {
            margin-top: 6px;
            padding: 10px 12px;
            font-size: 1.1rem;
            border-radius: 6px;
            border: 1px solid #555;
            background: #111;
            color: white;
            width: 100%;
            box-sizing: border-box;
        }

        /* ボタンも大きく、タップしやすく */
        .button {
            margin-top: 16px;
            padding: 12px 24px;
            font-size: 1.1rem;
            width: 100%;
            background: #555;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* PCでは元の位置に戻したい場合（メディアクエリ） */
        @media (min-width: 768px) {
            #controls {
                position: absolute;
                top: 10px;
                left: 10px;
                bottom: auto;
                right: auto;
                width: auto;
                max-height: none;
                padding: 12px;
                border-radius: 8px;
                background: rgba(0, 0, 0, 0.65);
            }

            label {
                display: block;
                margin: 6px 0;
                font-size: 1rem;
            }

            .button {
                width: auto;
                margin-top: 8px;
                padding: 6px 12px;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>

    <canvas id="StarCanvas"></canvas>

    <v-app id="App">
        <template>
            <main-system-bar :drawer="Drawer" @change-drawer="ChangeDrawer">Service > Constellation</main-system-bar>

            <v-main>
                <div id="controls">
                    <label>国:
                        <select id="country" onchange="updateDefaultByCountry()">
                            <option value="JP" selected>日本</option>
                            <option value="US">アメリカ (東部)</option>
                            <option value="GB">イギリス</option>
                            <option value="FR">フランス</option>
                            <option value="DE">ドイツ</option>
                            <option value="AU">オーストラリア (東部)</option>
                            <option value="custom">カスタム</option>
                        </select>
                    </label>

                    <label>緯度 (deg): <input type="number" id="lat" value="35.6895" step="0.1"></label>
                    <label>経度 (deg): <input type="number" id="lon" value="139.6917" step="0.1"></label>
                    <p id="standardMeridian" style="margin:8px 0; font-size:0.9em; color:#aaa;">
                        標準子午線: 135°E (東京)
                    </p>

                    <label>日付: <input type="date" id="date"></label>
                    <label>時間 (現地時): <input type="time" id="time" step="1"></label>
                    <button type="button" class="button" onclick="simulate()">表示更新</button>
                </div>
            </v-main>

            <main-navigation :drawer="Drawer" @change-drawer="ChangeDrawer"></main-navigation>
            <main-footer-simple></main-footer-simple>
        </template>
    </v-app>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="../../Asset/Javascript/Common.js?v=1.03"></script>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.171.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.171.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">

        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        const stars = [
            // ── 極めて明るい（-2等級 ～ -0.5等級クラス） ──
            { name: 'Sirius', ra: 101.2872, dec: -16.7161, mag: -1.46, color: '#ffffff' },    // 純白（わずかに青み）
            { name: 'Canopus', ra: 95.9879, dec: -52.6957, mag: -0.74, color: '#fffaf0' },    // 暖かみのある白
            { name: 'Alpha Centauri', ra: 219.9021, dec: -60.8339, mag: -0.27, color: '#ffffff' },    // 非常に明るい白

            // ── 0等級クラス ──
            { name: 'Arcturus', ra: 213.9153, dec: 19.1824, mag: -0.05, color: '#ffe4c4' },    // 淡いオレンジがかった白
            { name: 'Vega', ra: 279.2347, dec: 38.7837, mag: 0.03, color: '#f0f8ff' },    // 青白い
            { name: 'Capella', ra: 79.1723, dec: 45.9980, mag: 0.08, color: '#fffacd' },    // やや暖色がかった白
            { name: 'Rigel', ra: 78.6345, dec: -8.2016, mag: 0.18, color: '#e6f0fa' },    // 青みが強い白
            { name: 'Procyon', ra: 114.8258, dec: 5.2247, mag: 0.34, color: '#fffaf0' },    // 白～わずかに暖色

            // ── 0.5～1.0等級クラス ──
            { name: 'Achernar', ra: 24.4285, dec: -57.2368, mag: 0.45, color: '#f0f8ff' },    // 青白い
            { name: 'Betelgeuse', ra: 88.7929, dec: 7.4071, mag: 0.42, color: '#ff4500' },    // 強い赤（変光星）
            { name: 'Hadar', ra: 203.8640, dec: -60.3829, mag: 0.61, color: '#e6f0fa' },    // 青白い
            { name: 'Altair', ra: 297.6958, dec: 8.8683, mag: 0.77, color: '#ffffff' },    // 白
            { name: 'Acrux', ra: 186.6495, dec: -63.0991, mag: 0.77, color: '#e6f0fa' },    // 青白い
            { name: 'Aldebaran', ra: 68.9802, dec: 16.5093, mag: 0.87, color: '#ff8c00' },    // 強いオレンジ赤

            // ── 1.0～1.5等級クラス ──
            { name: 'Spica', ra: 201.2983, dec: -11.1614, mag: 0.98, color: '#e6f0fa' },    // 青白い
            { name: 'Antares', ra: 247.3519, dec: -26.4320, mag: 1.06, color: '#ff2d2d' },    // 強い赤
            { name: 'Pollux', ra: 116.3289, dec: 28.0262, mag: 1.14, color: '#ffa07a' },    // オレンジ
            { name: 'Fomalhaut', ra: 344.4127, dec: -29.6222, mag: 1.16, color: '#ffffff' },    // 白
            { name: 'Deneb', ra: 310.3580, dec: 45.2803, mag: 1.25, color: '#ffffff' },    // 白
            { name: 'Becrux', ra: 186.9725, dec: -59.6888, mag: 1.25, color: '#e6f0fa' },    // 青白い（Mimosa）
            { name: 'Regulus', ra: 152.0929, dec: 11.9672, mag: 1.36, color: '#e6f0fa' },    // 青白い

            // ── 1.5～2.0等級クラス ──
            { name: 'Adhara', ra: 104.6563, dec: -28.9721, mag: 1.50, color: '#e6f0fa' },
            { name: 'Castor', ra: 113.6499, dec: 31.8883, mag: 1.58, color: '#ffffff' },
            { name: 'Shaula', ra: 263.4022, dec: -37.1038, mag: 1.62, color: '#e6f0fa' },
            { name: 'Gacrux', ra: 187.7913, dec: -57.1132, mag: 1.64, color: '#ff6347' },    // 赤
            { name: 'Bellatrix', ra: 81.2827, dec: 6.3497, mag: 1.64, color: '#e6f0fa' },
            { name: 'Elnath', ra: 81.5728, dec: 28.6075, mag: 1.65, color: '#ffffff' },
            { name: 'Miaplacidus', ra: 97.4073, dec: -69.7175, mag: 1.67, color: '#e6f0fa' },
            { name: 'Alnilam', ra: 84.0534, dec: -1.2019, mag: 1.69, color: '#e6f0fa' },    // オリオン座の帯（中央）
            { name: 'Alnair', ra: 330.8939, dec: -46.9600, mag: 1.73, color: '#ffffff' },
            { name: 'Alnitak', ra: 85.1896, dec: -1.9428, mag: 1.74, color: '#e6f0fa' },    // オリオン座の帯（左）
            { name: 'Alioth', ra: 193.5072, dec: 55.9598, mag: 1.76, color: '#ffffff' },
            { name: 'Mirfak', ra: 51.0810, dec: 49.8612, mag: 1.79, color: '#fffacd' },    // 黄白色
            { name: 'Dubhe', ra: 165.9318, dec: 61.7510, mag: 1.81, color: '#ffa07a' },    // オレンジ
            { name: 'Wezen', ra: 108.0290, dec: -26.3932, mag: 1.83, color: '#fffacd' },
            { name: 'Alkaid', ra: 206.8851, dec: 49.3133, mag: 1.85, color: '#ffffff' },
            { name: 'Sargas', ra: 263.4022, dec: -37.1038, mag: 1.86, color: '#e6f0fa' },
            { name: 'Avior', ra: 125.6286, dec: -59.5095, mag: 1.86, color: '#ffa07a' },    // オレンジ
            { name: 'Menkalinan', ra: 94.6407, dec: 44.9474, mag: 1.90, color: '#fffacd' },
            { name: 'Atria', ra: 167.4890, dec: -69.0277, mag: 1.91, color: '#ffa07a' },
            { name: 'Alhena', ra: 103.4080, dec: 16.3990, mag: 1.93, color: '#ffffff' },
            { name: 'Peacock', ra: 306.4110, dec: -56.7350, mag: 1.94, color: '#e6f0fa' },
            { name: 'Polaris', ra: 37.9461, dec: 89.2641, mag: 1.97, color: '#fff5e1' },    // 淡い黄色
            { name: 'Alphard', ra: 141.8969, dec: -8.6586, mag: 1.99, color: '#ffa07a' },

            // ── 2.0～2.5等級クラス（一部） ──
            { name: 'Algieba', ra: 153.0987, dec: 19.8409, mag: 2.01, color: '#fffacd' },
            { name: 'Hamal', ra: 50.9803, dec: 23.4624, mag: 2.01, color: '#ffa07a' },
            { name: 'Diphda', ra: 10.8975, dec: 0.0829, mag: 2.04, color: '#ffffff' },
            { name: 'Nunki', ra: 275.2180, dec: -26.4320, mag: 2.05, color: '#e6f0fa' },
            { name: 'Menkent', ra: 210.2990, dec: -36.3700, mag: 2.06, color: '#ffa07a' },
            { name: 'Alpheratz', ra: 2.1197, dec: 29.0900, mag: 2.07, color: '#ffffff' },
            { name: 'Kochab', ra: 210.7630, dec: 74.1555, mag: 2.07, color: '#fff5e1' },
            { name: 'Rasalhague', ra: 263.4022, dec: 12.5667, mag: 2.08, color: '#ffffff' },
            { name: 'Algol', ra: 47.0422, dec: 40.9570, mag: 2.09, color: '#e6f0fa' },
            { name: 'Mirach', ra: 29.0617, dec: 35.6206, mag: 2.07, color: '#ffccaa' },
            { name: 'Saiph', ra: 86.9392, dec: -9.6696, mag: 2.07, color: '#e6f0fa' },
            { name: 'Denebola', ra: 177.2649, dec: 14.5721, mag: 2.14, color: '#ffffff' },
            { name: 'Eltanin', ra: 263.4070, dec: 51.4890, mag: 2.24, color: '#ffa07a' },
            { name: 'Schedar', ra: 9.1580, dec: 56.5370, mag: 2.24, color: '#ffccaa' },
            { name: 'Mizar', ra: 200.9812, dec: 54.9254, mag: 2.23, color: '#ffffff' },
            { name: 'Mintaka', ra: 83.0017, dec: -0.2991, mag: 2.25, color: '#e6f0fa' },
            { name: 'Caph', ra: 359.5140, dec: 59.1500, mag: 2.28, color: '#ffffff' },
            { name: 'Merak', ra: 165.4602, dec: 56.3825, mag: 2.34, color: '#ffffff' },
            { name: 'Phecda', ra: 178.4572, dec: 53.6950, mag: 2.41, color: '#ffffff' },
            { name: 'Markab', ra: 345.9430, dec: 15.2050, mag: 2.49, color: '#ffffff' },
            { name: 'Scheat', ra: 345.5510, dec: 28.0830, mag: 2.44, color: '#ffccaa' },
            { name: 'Enif', ra: 328.3520, dec: 9.8750, mag: 2.38, color: '#ffccaa' },

            // ── 2.5～3.0等級クラス（代表的な明るい星々） ──
            { name: 'Alpherg / Kullat Nunu', ra: 9.2187, dec: 23.4624, mag: 2.53, color: '#fff5e1' },      // η Psc - 淡い黄色がかった白（魚座の頭）
            { name: 'Alrai', ra: 30.1234, dec: 52.3010, mag: 2.54, color: '#ffccaa' },      // γ Cep - オレンジがかった
            { name: 'Menkib', ra: 81.5728, dec: 20.0015, mag: 2.55, color: '#e6f0fa' },      // ξ Per - 青白い（ペルセウス座）
            { name: 'Zubenelgenubi', ra: 229.2520, dec: -16.0418, mag: 2.75, color: '#e6f0fa' },    // α Lib - 青白い（天秤座α、連星）
            { name: 'Zubeneschamali', ra: 229.8519, dec: -9.3820, mag: 2.61, color: '#e6f0fa' },     // β Lib - 珍しい緑がかった白
            { name: 'Kornephoros', ra: 258.0070, dec: 21.4896, mag: 2.78, color: '#ffa07a' },     // β Her - オレンジ
            { name: 'Rastaban', ra: 263.7914, dec: 52.3013, mag: 2.79, color: '#ff6347' },     // β Dra - 橙赤っぽい
            { name: 'Eltanin / Gianfar', ra: 263.4070, dec: 51.4890, mag: 2.24, color: '#ffa07a' },     // γ Dra （※既に2.24で入ってるので省略可）
            { name: 'Aldebaranの伴星', ra: 68.98, dec: 16.51, mag: 2.8, color: '#ffffff' },   // （変光考慮、厳密にはAldebaran本体が0.87）
            { name: 'Gienah', ra: 185.9970, dec: 9.9313, mag: 2.58, color: '#e6f0fa' },      // γ Crv - 青白い（からす座）
            { name: 'Gacruxの次', ra: 187.7913, dec: -57.11, mag: 2.8, color: '#ff6347' },   // （Gacruxは既に1.64）
            { name: 'Mimosaの次', ra: 186.9725, dec: -59.69, mag: 2.9, color: '#e6f0fa' },      // 南十字座β付近の明るい星
            { name: 'Alphekka / Gemma', ra: 240.3600, dec: 26.7147, mag: 2.23, color: '#e6f0fa' },     // α CrB （※2.23でギリギリ既存範囲）
            { name: 'Unukalhai', ra: 242.5980, dec: 6.4258, mag: 2.63, color: '#ff6347' },      // α Ser - 橙色
            { name: 'Sabik', ra: 263.4022, dec: -12.5600, mag: 2.43, color: '#ffffff' },    // η Oph - 白（※2.43で既存範囲寄り）
            { name: 'Rasalgethi', ra: 263.4022, dec: 14.3900, mag: 2.8, color: '#ff4500' },  // α Her - 赤色変光星（変光範囲広い）
            { name: 'Kaus Australis', ra: 276.0430, dec: -34.3846, mag: 1.79, color: '#e6f0fa' },   // ε Sgr （※既存範囲）
            { name: 'Nunki', ra: 275.2180, dec: -26.4320, mag: 2.05, color: '#e6f0fa' },   // σ Sgr （※既存）
            { name: 'Ascella', ra: 280.0320, dec: -40.1075, mag: 2.60, color: '#ffffff' },    // ζ Sgr - 白
            { name: 'Kaus Media', ra: 274.6190, dec: -40.1075, mag: 2.70, color: '#e6f0fa' },    // δ Sgr - 青白い
            { name: 'Kaus Borealis', ra: 269.0630, dec: -25.4213, mag: 2.82, color: '#ffffff' },    // λ Sgr - 白
            { name: 'Vindemiatrix', ra: 195.5450, dec: 10.9591, mag: 2.85, color: '#ffffff' },     // ε Vir - 白
            { name: 'Zavijava', ra: 177.2650, dec: 1.7600, mag: 2.87, color: '#e6f0fa' },      // β Vir - 青白い
            { name: 'Porrima', ra: 191.2780, dec: -1.4490, mag: 2.74, color: '#e6f0fa' },     // γ Vir - 青白い連星
            { name: 'Auva', ra: 193.5070, dec: -0.3978, mag: 2.94, color: '#ffa07a' },     // δ Vir - オレンジ寄り

            // ── 3.0～3.5等級クラス（代表的な星々） ──
            { name: 'Megrez', ra: 165.460, dec: 57.033, mag: 3.32, color: '#ffffff' },          // δ UMa - 大熊座 - 純白（Big Dipperの柄の付け根）
            { name: 'Merak', ra: 165.460, dec: 56.383, mag: 2.34, color: '#ffffff' },           // β UMa - すでに2.3等級で入っている可能性あり
            { name: 'Phecda', ra: 178.457, dec: 53.695, mag: 2.41, color: '#ffffff' },          // γ UMa - すでに2.4等級付近
            { name: 'Alcor', ra: 201.306, dec: 54.988, mag: 3.99, color: '#ffffff' },          // 番外：ミザル（Mizar）の伴星、よく一緒に観測される
            { name: 'Mizar', ra: 200.981, dec: 54.925, mag: 2.23, color: '#ffffff' },          // ζ UMa - すでに2.2等級
            { name: 'Thuban', ra: 210.955, dec: 64.376, mag: 3.67, color: '#e6f0fa' },          // α Dra - 青白い、かつての北極星
            { name: 'Kochab', ra: 210.763, dec: 74.156, mag: 2.07, color: '#fff5e1' },          // β UMi - すでに2.0等級付近
            { name: 'Pherkad', ra: 225.299, dec: 71.585, mag: 3.05, color: '#e6f0fa' },         // γ UMi - 小熊座 - 青白い
            { name: 'Alya', ra: 279.235, dec: 30.561, mag: 3.48, color: '#ffffff' },          // θ Ser - へび座 - 白（二重星）
            { name: 'Alphekka / Gemma', ra: 240.360, dec: 26.715, mag: 2.23, color: '#e6f0fa' },// α CrB - コロナ・ボレアリス座 - すでに2.2等級
            { name: 'Nusakan', ra: 239.362, dec: 40.390, mag: 3.66, color: '#e6f0fa' },         // β CrB - 青白い
            { name: 'Seginus', ra: 229.252, dec: 38.318, mag: 3.04, color: '#ffffff' },         // γ Boo - うしかい座 - 白
            { name: 'Izar', ra: 221.246, dec: 27.074, mag: 2.70, color: '#ffa07a' },          // ε Boo - オレンジ（美しい二重星）
            { name: 'Muphrid', ra: 210.299, dec: 18.470, mag: 2.68, color: '#ffffff' },         // η Boo - 白
            { name: 'Alula Borealis', ra: 136.999, dec: 50.316, mag: 3.45, color: '#ffa07a' },  // ν UMa - 北斗七星付近 - オレンジ
            { name: 'Alula Australis', ra: 136.999, dec: 49.313, mag: 3.79, color: '#ffffff' },// ξ UMa - 二重星
            { name: 'Alkaphrah', ra: 139.043, dec: 56.383, mag: 3.45, color: '#ffffff' },       // κ UMa - 白
            { name: 'Talitha', ra: 140.299, dec: 51.672, mag: 3.12, color: '#e6f0fa' },         // ι UMa - 青白い
            { name: 'Tania Borealis', ra: 147.555, dec: 59.038, mag: 3.45, color: '#ffffff' },  // λ UMa - 白
            { name: 'Alkard', ra: 141.897, dec: -8.659, mag: 1.99, color: '#ffa07a' },          // α Hya - すでに2.0等級付近
            { name: 'Acubens', ra: 127.984, dec: 11.861, mag: 4.26, color: '#ffffff' },         // α Cnc - かに座 - やや暗め
            { name: 'Asellus Australis', ra: 125.628, dec: 21.468, mag: 3.94, color: '#ffa07a' },// δ Cnc - オレンジ
            { name: 'Asellus Borealis', ra: 124.292, dec: 25.755, mag: 4.66, color: '#ffffff' },// γ Cnc - 少し暗め
            { name: 'Tegmine', ra: 130.825, dec: 17.648, mag: 3.94, color: '#ffffff' },         // ζ Cnc - 多重星
            { name: 'Zosma', ra: 170.250, dec: 20.524, mag: 2.56, color: '#ffffff' },          // δ Leo - すでに2.5等級
            { name: 'Denebola', ra: 177.265, dec: 14.572, mag: 2.14, color: '#ffffff' },        // β Leo - すでに2.1等級

            // ── 3.5～4.0等級クラス（代表的な有名星・固有名星） ──
            { name: 'Alcor', ra: 201.306, dec: 54.988, mag: 3.99, color: '#ffffff' },              // うしかい座（Mizarの伴星、よく一緒に観測される）
            { name: 'Pherkad', ra: 225.299, dec: 71.585, mag: 3.05, color: '#e6f0fa' },            // γ UMi - 小熊座（すでに3.0付近で言及あり、参考）
            { name: 'Alya', ra: 279.235, dec: 30.561, mag: 3.48, color: '#ffffff' },               // θ Serpentis - へび座（二重星）
            { name: 'Nusakan', ra: 239.362, dec: 40.390, mag: 3.66, color: '#e6f0fa' },            // β Coronae Borealis - コロナ・ボレアリス座
            { name: 'Alula Borealis', ra: 136.999, dec: 50.316, mag: 3.45, color: '#ffa07a' },     // ν Ursae Majoris - 大熊座（北斗七星付近、オレンジ巨星）
            { name: 'Talitha', ra: 140.299, dec: 51.672, mag: 3.12, color: '#e6f0fa' },            // ι Ursae Majoris - 大熊座（青白い）
            { name: 'Tania Borealis', ra: 147.555, dec: 59.038, mag: 3.45, color: '#ffffff' },     // λ Ursae Majoris - 大熊座
            { name: 'Alkaphrah', ra: 139.043, dec: 56.383, mag: 3.45, color: '#ffffff' },          // κ Ursae Majoris - 大熊座
            { name: 'Asellus Australis', ra: 125.628, dec: 21.468, mag: 3.94, color: '#ffa07a' },  // δ Cancri - かに座（オレンジ）
            { name: 'Tegmine', ra: 130.825, dec: 17.648, mag: 3.94, color: '#ffffff' },            // ζ Cancri - かに座（多重星）
            { name: 'Alhena', ra: 103.408, dec: 16.399, mag: 1.93, color: '#ffffff' },             // γ Geminorum - ふたご座（すでに1.9等級で既存）
            { name: 'Wasat', ra: 108.029, dec: 21.982, mag: 3.53, color: '#ffffff' },              // δ Geminorum - ふたご座
            { name: 'Mebsuta', ra: 103.818, dec: 25.131, mag: 3.06, color: '#ffffff' },            // ε Geminorum - ふたご座（少し明るめ）
            { name: 'Mekbuda', ra: 88.793, dec: 20.570, mag: 3.79, color: '#ffa07a' },             // ζ Geminorum - ふたご座（セフェイド変光星）
            { name: 'Alzirr', ra: 111.542, dec: 16.399, mag: 3.35, color: '#e6f0fa' },             // ξ Geminorum - ふたご座
            { name: 'Tejat Posterior', ra: 103.818, dec: 33.157, mag: 3.17, color: '#ffa07a' },    // μ Geminorum - ふたご座
            { name: 'Propus', ra: 88.793, dec: 22.947, mag: 3.31, color: '#ffa07a' },              // ι Geminorum - ふたご座（変光考慮）
            { name: 'Alhenaの次', ra: 103.408, dec: 16.399, mag: 3.8, color: '#ffffff' },         // ふたご座周辺の参考
            { name: 'Chort', ra: 170.250, dec: 20.524, mag: 2.56, color: '#ffffff' },              // θ Leonis - しし座（すでに2.5等級）
            { name: 'Zosma', ra: 170.250, dec: 20.524, mag: 2.56, color: '#ffffff' },              // δ Leonis - しし座（重複注意）
            { name: 'Denebola', ra: 177.265, dec: 14.572, mag: 2.14, color: '#ffffff' },           // β Leonis - しし座（すでに2.1等級）
            { name: 'Regulusの次', ra: 152.093, dec: 11.967, mag: ~3.9, color: '#e6f0fa' },        // しし座の足元付近

        ];

        let scene, camera, renderer, controls, composer;
        let bloomPass;

        // 国ごとのデフォルト設定（東京に変更済み）
        const countryDefaults = {
            JP: { lat: 35.6895, lon: 139.6917, name: "東京", stdMeridian: 135, tzOffset: 9 },
            US: { lat: 40.71, lon: -74.01, name: "ニューヨーク", stdMeridian: -75, tzOffset: -5 },
            GB: { lat: 51.51, lon: -0.13, name: "ロンドン", stdMeridian: 0, tzOffset: 0 },
            FR: { lat: 48.86, lon: 2.35, name: "パリ", stdMeridian: 15, tzOffset: 1 },
            DE: { lat: 52.52, lon: 13.41, name: "ベルリン", stdMeridian: 15, tzOffset: 1 },
            AU: { lat: -33.87, lon: 151.21, name: "シドニー", stdMeridian: 150, tzOffset: 11 }, // 2026年1月は夏時間
            custom: { lat: 35.0, lon: 135.0, name: "カスタム", stdMeridian: null, tzOffset: 9 }
        };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000814);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
            camera.position.set(0.8, 0.3, 0.8);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, canvas: document.getElementById('StarCanvas') });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // ── Post Processing ──
            composer = new EffectComposer(renderer);
            const renderPass = new RenderPass(scene, camera);
            composer.addPass(renderPass);

            bloomPass = new UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                1,     // strength
                1,    // radius
                0.85      // threshold ← 暗い星はほとんど光らない
            );
            composer.addPass(bloomPass);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.06;
            controls.rotateSpeed = 0.55;
            controls.enableZoom = false;
            controls.enablePan = false;
            controls.enableRotate = true;
            camera.fov = 120;
            camera.updateProjectionMatrix();
            function handleZoom(delta) {
                // delta > 0 → ズームアウト（視野角大きく）
                // delta < 0 → ズームイン（視野角小さく）
                const zoomFactor = 1 + delta * 0.0008;
                camera.fov = THREE.MathUtils.clamp(
                    camera.fov * zoomFactor,
                    10,
                    120
                );
                camera.updateProjectionMatrix();
            }
            // マウスホイール
            renderer.domElement.addEventListener('wheel', (event) => {
                event.preventDefault();
                handleZoom(event.deltaY);
            }, { passive: false });
            // ピンチ
            let lastTouchDistance = null;
            let isPinching = false;
            renderer.domElement.addEventListener(
                'touchstart',
                (event) => {
                    if (event.touches.length === 2) {
                        const dx =
                            event.touches[0].clientX -
                            event.touches[1].clientX;
                        const dy =
                            event.touches[0].clientY -
                            event.touches[1].clientY;

                        lastTouchDistance = Math.hypot(dx, dy);
                        isPinching = true;

                        controls.enableRotate = false;
                    }
                },
                { passive: false }
            );
            renderer.domElement.addEventListener(
                'touchmove',
                (event) => {
                    if (event.touches.length !== 2 || !isPinching) return;

                    event.preventDefault();

                    const dx =
                        event.touches[0].clientX -
                        event.touches[1].clientX;
                    const dy =
                        event.touches[0].clientY -
                        event.touches[1].clientY;

                    const currentDistance = Math.hypot(dx, dy);
                    const delta = lastTouchDistance - currentDistance;

                    if (Math.abs(delta) > 0.5) {
                        handleZoom(delta * 10);
                        lastTouchDistance = currentDistance;
                    }
                },
                { passive: false }
            );
            renderer.domElement.addEventListener(
                'touchend',
                (event) => {
                    if (event.touches.length < 2) {
                        lastTouchDistance = null;
                        isPinching = false;

                        controls.enableRotate = true;
                    }
                },
                { passive: false }
            );

            window.addEventListener('resize', onWindowResize);
            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            composer.render();
        }

        // 以下は元のコードとほぼ同じ（緯度経度・時間計算部分）
        function degToRad(deg) { return deg * Math.PI / 180; }

        function JulianDateFromUnixTime(t) {
            return (t / 86400000) + 2440587.5;
        }

        function greenwichMeanSiderealTime(jd) {
            const t = (jd - 2451545.0) / 36525.0;
            let gmst = 280.46061837 + 360.98564736629 * (jd - 2451545.0) + 0.000387933 * t * t - t * t * t / 38710000;
            gmst = (gmst % 360 + 360) % 360;
            return degToRad(gmst);
        }

        function raDecToAltAz(ra, dec, lat, lon, jd) {
            const gmst = greenwichMeanSiderealTime(jd);
            let lst = gmst + lon;
            let ha = lst - ra;

            ha = ((ha % (2 * Math.PI)) + 2 * Math.PI) % (2 * Math.PI);
            if (ha > Math.PI) ha -= 2 * Math.PI;

            const sinAlt = Math.sin(lat) * Math.sin(dec) + Math.cos(lat) * Math.cos(dec) * Math.cos(ha);
            const alt = Math.asin(sinAlt);

            let az = Math.atan2(
                Math.sin(ha) * Math.cos(dec),
                Math.cos(ha) * Math.sin(lat) * Math.cos(dec) - Math.sin(dec) * Math.cos(lat)
            );
            az = (az + 2 * Math.PI) % (2 * Math.PI);

            return { az, alt };
        }

        window.updateDefaultByCountry = function () {
            const country = document.getElementById('country').value;
            const def = countryDefaults[country] || countryDefaults.custom;
            document.getElementById('lat').value = def.lat.toFixed(4);
            document.getElementById('lon').value = def.lon.toFixed(4);
            document.getElementById('standardMeridian').textContent =
                def.stdMeridian !== null
                    ? `標準子午線: ${Math.abs(def.stdMeridian)}°${def.stdMeridian >= 0 ? 'E' : 'W'}`
                    : `標準子午線: --- (カスタム)`;
        };

        // 現在の日時を入力欄にセット（日本時間）
        function setCurrentDateTime() {
            const now = new Date();
            // 日本時間に強制（tzOffset=9）
            const jpTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (9 * 3600000));

            const dateStr = jpTime.toISOString().split('T')[0];
            const timeStr = jpTime.toTimeString().slice(0, 5);

            document.getElementById('date').value = dateStr;
            document.getElementById('time').value = timeStr;
        }

        // 16進数をRGBに変換するヘルパー
        function hexToRgb(hex) {
            hex = hex.replace('#', '');
            const bigint = parseInt(hex, 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }

        // ── 暖色（赤・オレンジ・黄系）かどうかを判定 ──
        function isWarmColor(hex) {
            const { r, g, b } = hexToRgb(hex);

            // 基本条件：赤成分がかなり強い
            if (r < 180) return false;  // 赤が弱い → 冷色寄り

            // 暖色判定のメイン条件（以下のいずれかを満たせば暖色）
            const conditions = [
                // 強い赤～赤橙（Betelgeuse, Antares系）
                r > 210 && g < 100 && b < 100,

                // オレンジ～黄橙（Aldebaran, Pollux, Arcturus系）
                r > 210 && g > 120 && g < 200 && b < 140,

                // 淡いオレンジ・黄味がかった白（Arcturus, Menkalinan系）
                r > 230 && g > 180 && b < 160 && (r - g) < 70,

                // 赤みが強いが少し青を含む場合も救済（自然な暖色範囲）
                r > g * 1.35 && r > b * 1.4 && (g + b > 100)
            ];

            return conditions.some(cond => cond === true);
        }

        window.simulate = function () {
            const latDeg = parseFloat(document.getElementById('lat').value) || 35;
            const lonDeg = parseFloat(document.getElementById('lon').value) || 135;
            const dateStr = document.getElementById('date').value;
            const timeStr = document.getElementById('time').value;

            if (!dateStr || !timeStr) return;

            const country = document.getElementById('country').value;
            const tzOffset = countryDefaults[country]?.tzOffset ?? 9;

            const [year, month, day] = dateStr.split('-').map(Number);
            const [hour, min] = timeStr.split(':').map(Number);

            const localDate = new Date(Date.UTC(year, month - 1, day, hour, min, 0));
            const utcDate = new Date(localDate.getTime() - tzOffset * 3600000);
            const jd = JulianDateFromUnixTime(utcDate.getTime());

            const lat = degToRad(latDeg);
            const lon = degToRad(lonDeg);

            // 古い星を削除
            scene.children.forEach(child => {
                if (child.type === 'Points') {
                    scene.remove(child);
                    child.geometry?.dispose();
                    child.material?.dispose();
                }
            });

            const positions = [];
            const colors = [];
            const sizes = [];

            stars.forEach(star => {
                const raRad = degToRad(star.ra);
                const decRad = degToRad(star.dec);

                const { az, alt } = raDecToAltAz(raRad, decRad, lat, lon, jd);

                // if (alt <= 0) return; // 地平線以下は非表示

                const theta = Math.PI / 2 - alt;
                const phi = az;

                const radius = 600;
                const x = radius * Math.sin(theta) * Math.cos(phi);
                const z = radius * Math.sin(theta) * Math.sin(phi);
                const y = radius * Math.cos(theta);

                // サイズ計算（かなり抑えめに）
                let size = (3.0 - star.mag) * 3;
                size = Math.max(6, Math.min(15, size));

                positions.push(x, y, z);

                // 明るさ（発光強度）を色に反映
                const col = new THREE.Color(star.color);

                // 色温度的な暖色系（赤・オレンジ）を少し強く光らせる補正
                const warmBoost = isWarmColor(star.color) ? 6 : 1.0;
                const baseBrightness = Math.pow(2, -star.mag * 0.4);
                const brightness = baseBrightness * warmBoost;
                col.multiplyScalar(brightness * 4.5);

                colors.push(col.r, col.g, col.b);

                sizes.push(size);
            });

            if (positions.length === 0) return;

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));

            // カスタムシェーダーで個別サイズをサポート
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    scale: { value: window.innerHeight / 2 }
                },
                vertexShader: `
                    attribute float size;
                    varying vec3 vColor;

                    void main() {
                        vColor = color;
                        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                        gl_PointSize = size * (300.0 / -mvPosition.z); // 遠近法調整
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `,
                fragmentShader: `
                    varying vec3 vColor;
                    void main() {
                        vec2 coord = gl_PointCoord - vec2(0.5);
                        float dist = length(coord);
                        if (dist > 0.49) discard;           // より厳密な円形
                        float alpha = 1.0 - smoothstep(0.40, 0.49, dist); // 柔らかい縁
                        gl_FragColor = vec4(vColor, alpha);
                    }
                `,
                vertexColors: true,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthTest: false,
                depthWrite: false
            });

            const points = new THREE.Points(geometry, material);
            scene.add(points);
        }

        // 初期化＆初回表示
        init();
        window.addEventListener('DOMContentLoaded', () => {
            updateDefaultByCountry();
            setCurrentDateTime();
            simulate();
        });

        window.vue = new Vue({
            el: '#App',
            vuetify: new Vuetify(),
            mixins: [window.Mixins_Common]
        });

    </script>
</body>

</html>