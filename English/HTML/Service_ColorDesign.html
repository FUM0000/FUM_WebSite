<html>

<head>
    <meta charset="UTF-8">
    <meta name="author" content="F U M">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B89KY0993B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-B89KY0993B');
    </script>

    <link rel="icon" type="image/x-icon" href="../../Asset/Image/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../../Asset/Image/Icon_1_2.jpg">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:100,300,400,500,700,900&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="../../Asset/CSS/Common.css?v=1.0" rel="stylesheet" />

    <title>Color Design</title>

    <style>
        .v-slider__thumb {
            transition: background-color 0.3s ease;
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
        }

        .v-slider__track-background {
            transition: background 0.3s ease;
        }

        .v-slider__track-fill {
            transition: background 0.3s ease;
        }

        .v-slider__thumb-label {
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
            /* Add text shadow to the label value */
        }

        .gradient-preview {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            margin: 0px 0;
            transition: background 0.3s;
        }

        .css-code {
            font-family: monospace;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
        }

        #exportCanvas {
            display: none;
        }
    </style>
</head>

<body>

    <v-app id="App">
        <template>

            <main-system-bar :drawer="Drawer" @change-drawer="ChangeDrawer">Service > Color Design</main-system-bar>

            <v-main id="Main">
                <transition name="Fade_Page">
                    <v-container v-show="Ready_Page" fluid fill-height class="pa-5"
                        style="display: flex; align-content: center;">

                        <canvas id="exportCanvas"></canvas>

                        <v-row justify="center">
                            <v-col xs="12" md="6" align="center">
                                <v-card max-width="500">
                                    <v-card-text>

                                        <v-row>
                                            <v-col cols="12" class="text-center mt-5 mb-2">
                                                <h2>Color</h2>
                                            </v-col>
                                        </v-row>

                                        <v-row justify="center">
                                            <v-col cols="12">
                                                <div
                                                    :style="{ backgroundColor: hexColor, height: '200px', borderRadius: '8px' }">
                                                </div>
                                            </v-col>
                                            <v-col cols="12" align="start" class="pt-0">
                                                <v-btn-toggle v-model="colorMode" mandatory>
                                                    <v-btn value="rgb">RGB</v-btn>
                                                    <v-btn value="hsl">HSL</v-btn>
                                                </v-btn-toggle>
                                            </v-col>
                                            <template v-if="colorMode === 'rgb'">
                                                <v-col cols="12" class="pt-0 pb-0">
                                                    Red (R)
                                                    <v-slider v-model="red" min="0" max="255" thumb-label
                                                        :thumb-color="`rgb(${red}, 0, 0)`"
                                                        :track-color="`linear-gradient(to right, rgb(0, 0, 0), rgb(255, 0, 0))`"
                                                        :track-fill-color="`rgb(${red}, 0, 0)`"></v-slider>
                                                </v-col>
                                                <v-col cols="12" class="pt-0 pb-0">
                                                    Green (G)
                                                    <v-slider v-model="green" min="0" max="255" thumb-label
                                                        :thumb-color="`rgb(0, ${green}, 0)`"
                                                        :track-color="`linear-gradient(to right, rgb(0, 0, 0), rgb(0, 255, 0))`"
                                                        :track-fill-color="`rgb(0, ${green}, 0)`"></v-slider>
                                                </v-col>
                                                <v-col cols="12" class="pt-0 pb-0">
                                                    Blue (B)
                                                    <v-slider v-model="blue" min="0" max="255" thumb-label
                                                        :thumb-color="`rgb(0, 0, ${blue})`"
                                                        :track-color="`linear-gradient(to right, rgb(0, 0, 0), rgb(0, 0, 255))`"
                                                        :track-fill-color="`rgb(0, 0, ${blue})`"></v-slider>
                                                </v-col>
                                            </template>
                                            <template v-else>
                                                <v-col cols="12" class="pt-0 pb-0">
                                                    Hue (H)
                                                    <v-slider v-model="hue" min="0" max="360" thumb-label
                                                        :thumb-color="getHueColor(hue)" :track-color="`linear-gradient(to right, 
                                                            hsl(0, 100%, 50%),
                                                            hsl(60, 100%, 50%),
                                                            hsl(120, 100%, 50%),
                                                            hsl(180, 100%, 50%),
                                                            hsl(240, 100%, 50%),
                                                            hsl(300, 100%, 50%),
                                                            hsl(360, 100%, 50%))`" :track-fill-color="getHueColor(hue)"
                                                        ref="hueSlider"></v-slider>
                                                </v-col>
                                                <v-col cols="12" class="pt-0 pb-0">
                                                    Saturation (S)
                                                    <v-slider v-model="saturation" min="0" max="100" thumb-label
                                                        :thumb-color="`hsl(${hue}, ${saturation}%, ${lightness}%)`"
                                                        :track-color="`linear-gradient(to right, 
                                                            hsl(${hue}, 0%, ${lightness}%), 
                                                            hsl(${hue}, 100%, ${lightness}%))`"
                                                        :track-fill-color="`hsl(${hue}, ${saturation}%, ${lightness}%)`"
                                                        ref="saturationSlider"></v-slider>
                                                </v-col>
                                                <v-col cols="12" class="pt-0 pb-0">
                                                    Lightness (L)
                                                    <v-slider v-model="lightness" min="0" max="100" thumb-label
                                                        :thumb-color="`hsl(${hue}, ${saturation}%, ${lightness}%)`"
                                                        :track-color="`linear-gradient(to right, 
                                                            hsl(${hue}, ${saturation}%, 0%), 
                                                            hsl(${hue}, ${saturation}%, 50%), 
                                                            hsl(${hue}, ${saturation}%, 100%))`"
                                                        :track-fill-color="`hsl(${hue}, ${saturation}%, ${lightness}%)`"
                                                        ref="lightnessSlider"></v-slider>
                                                </v-col>
                                            </template>
                                            <v-col cols="12">
                                                <div class="d-flex flex-wrap justify-center mb-2">
                                                    <v-btn v-for="preset in presets.slice(1,6)" :key="preset.name"
                                                        @click="applyPreset(preset)" class="ma-1 ml-0" small :style="{
                                                        backgroundColor: `hsl(${hue}, ${preset.s}%, ${preset.l}%)`,
                                                        color: '#FFFFFF',
                                                        textShadow: '1px 1px 2px rgba(0,0,0,0.4)',
                                                        padding: '4px 4px',
                                                        fontSize: '0.8em'
                                                    }">
                                                        {{ preset.name }}
                                                    </v-btn>
                                                </div>
                                                <div class="d-flex flex-wrap justify-center mb-2">
                                                    <v-btn v-for="preset in presets.slice(6,10)" :key="preset.name"
                                                        @click="applyPreset(preset)" class="ma-1 ml-0" small :style="{
                                                        backgroundColor: `hsl(${hue}, ${preset.s}%, ${preset.l}%)`,
                                                        color: '#FFFFFF',
                                                        textShadow: '1px 1px 2px rgba(0,0,0,0.4)',
                                                        padding: '4px 4px',
                                                        fontSize: '0.8em'
                                                    }">
                                                        {{ preset.name }}
                                                    </v-btn>
                                                </div>
                                                <div class="d-flex flex-wrap justify-center">
                                                    <v-btn v-for="preset in presets.slice(10)" :key="preset.name"
                                                        @click="applyPreset(preset)" class="ma-1 ml-0" small :style="{
                                                        backgroundColor: `hsl(${hue}, ${preset.s}%, ${preset.l}%)`,
                                                        color: '#FFFFFF',
                                                        textShadow: '1px 1px 2px rgba(0,0,0,0.4)',
                                                        padding: '4px 4px',
                                                        fontSize: '0.8em'
                                                    }">
                                                        {{ preset.name }}
                                                    </v-btn>
                                                </div>
                                                <div class="d-flex flex-wrap justify-center mt-2">
                                                    <v-btn width="270" v-for="preset in presets.slice(0,1)"
                                                        :key="preset.name" @click="applyPreset(preset)" class="ma-1"
                                                        small
                                                        style="background-color: #FFFFFF; color: #000000; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); padding: 4px 4px;">
                                                        {{ preset.name }}
                                                    </v-btn>
                                                </div>
                                            </v-col>

                                            <v-col cols="12"
                                                class="text-center d-flex justify-space-between align-start">
                                                <v-text-field v-model="hexInput" outlined dense class="flex-grow-1 mr-2"
                                                    @input="updateFromHexInput" :rules="[rules.hexColor]"
                                                    hint="Ex: #FF0000" persistent-hint></v-text-field>
                                                <v-btn :color="hexColor" @click="copyColor" :style="{ 
                                                        color: '#FFFFFF',
                                                        textShadow: '1px 1px 2px rgba(0,0,0,0.4)'
                                                    }" width="50%">
                                                    {{ copyButtonText }}
                                                </v-btn>
                                            </v-col>
                                            <v-col cols="12" class="d-flex justify-space-between align-center">
                                                <v-spacer></v-spacer>
                                                <v-btn block @click="saveCurrentColor" outlined :color="hexColor"
                                                    :style="{ 
                                        borderColor: hexColor, 
                                        color: hexColor,
                                        textShadow: '1px 1px 2px rgba(0,0,0,0.4)' // Changed from 0.2 to 0.4 for darker shadow
                                    }" elevation="2">
                                                    Save Color
                                                </v-btn>
                                            </v-col>
                                        </v-row>

                                        <v-row justify="center">
                                            <v-col cols="12">
                                                <v-card v-if="savedColors.length > 0">
                                                    <v-card-text class="pt-5">
                                                        <v-row justify="center">
                                                            <v-col v-for="(color, index) in savedColors" :key="index"
                                                                cols="auto" class="d-flex align-center pa-0">
                                                                <v-chip class="mr-1 mb-1" :color="color"
                                                                    @click="loadColor(color)"
                                                                    :style="{ color: getContrastColor(color), padding: '8px 13px', borderRadius: '12px', fontSize: '0.8em' }"
                                                                    close @click:close="removeColor(index)">
                                                                    {{ color }}
                                                                </v-chip>
                                                            </v-col>
                                                        </v-row>
                                                    </v-card-text>
                                                </v-card>
                                            </v-col>
                                        </v-row>
                                    </v-card-text>
                                </v-card>
                            </v-col>
                        </v-row>

                        <v-row justify="center">
                            <v-col xs="12" md="6" align="center">
                                <v-card max-width="500">
                                    <v-card-text>
                                        <v-row>
                                            <v-col cols="12" class="text-center my-5">
                                                <h2>Gradation</h2>
                                            </v-col>
                                        </v-row>

                                        <v-row>
                                            <v-col cols="12" md="6" class="pt-0 pb-0">
                                                <v-select v-model="gradientType" :items="gradientTypes" label="Type"
                                                    outlined></v-select>
                                            </v-col>

                                            <v-col cols="12" md="6" class="pt-0 pb-0">
                                                <v-text-field v-model="angle" type="number" label="Angle" outlined
                                                    min="0" max="360"
                                                    :disabled="gradientType === 'radial'"></v-text-field>
                                            </v-col>
                                        </v-row>

                                        <v-row>
                                            <v-col class="pt-0 pb-0" cols="12" md="6" v-for="(color, index) in colors"
                                                :key="index">
                                                <v-color-picker v-model="colors[index]" mode="hexa"
                                                    hide-mode-switch></v-color-picker>
                                            </v-col>
                                        </v-row>

                                        <v-row>
                                            <v-col cols="12" class="pt-0 pb-0">
                                                <div class="gradient-preview" :style="gradientStyle"></div>
                                            </v-col>
                                        </v-row>

                                        <v-row>
                                            <v-col cols="12" class="pb-0">
                                                <v-switch inset class="mt-0" v-model="maintainAspectRatio"
                                                    label="Maintain Aspect"></v-switch>
                                            </v-col>
                                        </v-row>
                                        <v-row>
                                            <v-col cols="12" md="4" class="pt-0 pb-0">
                                                <v-text-field v-model="imageWidth" type="number" label="Width (px)"
                                                    outlined min="1" @input="handleWidthChange"></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4" class="pt-0 pb-0">
                                                <v-text-field v-model="imageHeight" type="number" label="Height (px)"
                                                    outlined min="1" @input="handleHeightChange"></v-text-field>
                                            </v-col>
                                            <v-col cols="12" md="4" class="pt-0 pb-0">
                                                <v-select v-model="imageFormat" :items="imageFormats" label="Format"
                                                    outlined></v-select>
                                            </v-col>
                                        </v-row>

                                        <v-row v-if="imageFormat === 'jpeg'">
                                            <v-col cols="12">
                                                <v-slider v-model="jpegQuality" label="Quality" thumb-label="always"
                                                    min="0" max="100" step="1"></v-slider>
                                            </v-col>
                                        </v-row>

                                        <v-row>
                                            <v-col cols="12">
                                                <v-btn block :style="{ 
                                                    background: gradientCSS,
                                                    color: '#FFFFFF',
                                                    textShadow: '1px 1px 2px rgba(0,0,0,0.4)'
                                                }" class="mr-4" @click="exportImage">
                                                    Download Image
                                                </v-btn>
                                            </v-col>
                                        </v-row>

                                        <v-row>
                                            <v-col cols="12">
                                                <v-btn block @click="saveCurrentGradient" outlined :style="{ 
                                                    borderColor: colors[1], 
                                                    color: colors[1],
                                                    textShadow: '1px 1px 2px rgba(0,0,0,0.4)'
                                                }">
                                                    Save Gradient
                                                </v-btn>
                                            </v-col>
                                        </v-row>

                                        <v-row v-if="savedGradients.length > 0">
                                            <v-col cols="12">
                                                <v-card>
                                                    <v-card-text class="pt-5">
                                                        <v-row justify="center">
                                                            <v-col v-for="(gradient, index) in savedGradients"
                                                                :key="index" cols="12" class="pt-0 pb-0 ma-0 mb-1">
                                                                <v-chip class="gradient-chip" close
                                                                    @click="loadGradient(gradient)"
                                                                    @click:close="removeGradient(index)"
                                                                    style="height: 32px;"
                                                                    :style="{ background: gradient.css }">
                                                                    <span
                                                                        :style="{ color: '#FFFFFF', textShadow: '1px 1px 2px rgba(0,0,0,0.4)', fontSize: '0.8em' }">
                                                                        {{ gradient.colors.join(' → ') }}
                                                                    </span>
                                                                </v-chip>
                                                            </v-col>
                                                        </v-row>
                                                    </v-card-text>
                                                </v-card>
                                            </v-col>
                                        </v-row>

                                        <v-row>
                                            <v-col cols="12">
                                                <v-card>
                                                    <v-card-title>CSS Code</v-card-title>
                                                    <v-card-text>
                                                        <div class="css-code">
                                                            background: {{ gradientCSS }};
                                                        </div>
                                                        <v-btn block class="mt-4" :style="{ 
                                                            background: gradientCSS,
                                                            color: '#FFFFFF',
                                                            textShadow: '1px 1px 2px rgba(0,0,0,0.4)'
                                                        }" @click="copyToClipboard">
                                                            Copy
                                                        </v-btn>
                                                    </v-card-text>
                                                </v-card>
                                            </v-col>
                                        </v-row>
                                    </v-card-text>
                                </v-card>
                            </v-col>
                        </v-row>

                    </v-container>
                </transition>
            </v-main>

            <main-navigation :drawer="Drawer" @change-drawer="ChangeDrawer"></main-navigation>
            <main-footer></main-footer>

        </template>
    </v-app>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="../../Asset/Javascript/Common.js?v=1.0"></script>

    <script>
        new Vue({
            el: '#App',
            vuetify: new Vuetify(),
            mixins: [window.Mixins_Common],
            data: {
                colorMode: 'rgb',
                red: 128,
                green: 128,
                blue: 128,
                hue: 0,
                saturation: 50,
                lightness: 50,
                copyButtonText: 'Copy Code',
                savedColors: [],
                hexInput: '#808080', // Initialize with the default color
                presets: [
                    { name: 'RESET', h: 180, s: 50, l: 50, color: '#FFFFFF' },
                    { name: 'DARK', h: 180, s: 100, l: 20, color: 'hsl(180, 100%, 20%)' },
                    { name: 'DEEP', h: 180, s: 80, l: 30, color: 'hsl(180, 80%, 30%)' },
                    { name: 'DULL', h: 180, s: 30, l: 50, color: 'hsl(180, 30%, 50%)' },
                    { name: 'SOFT', h: 180, s: 40, l: 70, color: 'hsl(180, 40%, 70%)' },
                    { name: 'PALE', h: 180, s: 30, l: 85, color: 'hsl(180, 30%, 85%)' },
                    { name: 'VIVID', h: 180, s: 100, l: 50, color: 'hsl(180, 100%, 50%)' },
                    { name: 'STRONG', h: 180, s: 85, l: 45, color: 'hsl(180, 85%, 45%)' },
                    { name: 'BRIGHT', h: 180, s: 75, l: 65, color: 'hsl(180, 75%, 65%)' },
                    { name: 'LIGHT', h: 180, s: 70, l: 80, color: 'hsl(180, 70%, 80%)' },
                    { name: 'DARK GREYISH', h: 180, s: 10, l: 30, color: 'hsl(180, 10%, 30%)' },
                    { name: 'GREYISH', h: 180, s: 10, l: 50, color: 'hsl(180, 10%, 50%)' },
                    { name: 'LIGHT GREYISH', h: 180, s: 10, l: 70, color: 'hsl(180, 10%, 70%)' }
                ],
                rules: {
                    hexColor: v => /^#[0-9A-F]{6}$/i.test(v) || 'Please enter a valid hex color code (e.g. #FF0000)',
                },
                gradientType: 'linear',
                gradientTypes: [
                    { text: 'Linear', value: 'linear' },
                    { text: 'Radial', value: 'radial' }
                ],
                angle: 90,
                colors: ['#FF0000', '#0000FF'],
                imageWidth: 1024,
                imageHeight: 1024,
                maintainAspectRatio: true,
                aspectRatio: 1,
                imageFormat: 'png',
                imageFormats: [
                    { text: 'PNG', value: 'png' },
                    { text: 'JPEG', value: 'jpeg' }
                ],
                jpegQuality: 90,
                savedGradients: [],
            },
            methods: {
                getHueColor(h) {
                    return `hsl(${h}, 100%, 50%)`;
                },
                copyColor() {
                    navigator.clipboard.writeText(this.hexColor)
                        .then(() => {
                            this.copyButtonText = 'Copied!';
                            setTimeout(() => {
                                this.copyButtonText = 'Copy Color';
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Failed to copy:', err);
                        });
                },
                getContrastColor(hexcolor) {
                    const hex = hexcolor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);

                    // Convert RGB to HSL
                    const rNorm = r / 255;
                    const gNorm = g / 255;
                    const bNorm = b / 255;

                    const max = Math.max(rNorm, gNorm, bNorm);
                    const min = Math.min(rNorm, gNorm, bNorm);
                    const l = (max + min) / 2;

                    // Use 80% as the threshold
                    return l > 0.8 ? '#000000' : '#FFFFFF';
                },
                saveCurrentColor() {
                    if (!this.savedColors.includes(this.hexColor)) {
                        this.savedColors.push(this.hexColor);
                        // Save to localStorage
                        localStorage.setItem('savedColors', JSON.stringify(this.savedColors));
                    }
                },
                removeColor(index) {
                    this.savedColors.splice(index, 1);
                    // Update localStorage
                    localStorage.setItem('savedColors', JSON.stringify(this.savedColors));
                },
                loadColor(hexColor) {
                    const hex = hexColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);

                    if (this.colorMode === 'rgb') {
                        this.red = r;
                        this.green = g;
                        this.blue = b;
                    } else {
                        // Convert RGB to HSL
                        const rNorm = r / 255;
                        const gNorm = g / 255;
                        const bNorm = b / 255;

                        const max = Math.max(rNorm, gNorm, bNorm);
                        const min = Math.min(rNorm, gNorm, bNorm);
                        const d = max - min;

                        let h = 0;
                        if (d === 0) h = 0;
                        else if (max === rNorm) h = 60 * ((gNorm - bNorm) / d % 6);
                        else if (max === gNorm) h = 60 * ((bNorm - rNorm) / d + 2);
                        else if (max === bNorm) h = 60 * ((rNorm - gNorm) / d + 4);

                        if (h < 0) h += 360;

                        const l = (max + min) / 2;
                        const s = d === 0 ? 0 : d / (1 - Math.abs(2 * l - 1));

                        this.hue = Math.round(h);
                        this.saturation = Math.round(s * 100);
                        this.lightness = Math.round(l * 100);
                    }
                },
                updateFromHexInput(value) {
                    // Validate hex color format
                    if (/^#[0-9A-F]{6}$/i.test(value)) {
                        const hex = value.replace('#', '');
                        const r_val = parseInt(hex.substr(0, 2), 16);
                        const g_val = parseInt(hex.substr(2, 2), 16);
                        const b_val = parseInt(hex.substr(4, 2), 16);

                        if (this.colorMode === 'rgb') {
                            this.red = r_val;
                            this.green = g_val;
                            this.blue = b_val;
                        } else { // HSLモードの場合
                            // Hexから取得したRGB値をHSLに変換
                            const rNorm = r_val / 255;
                            const gNorm = g_val / 255;
                            const bNorm = b_val / 255;

                            const max = Math.max(rNorm, gNorm, bNorm);
                            const min = Math.min(rNorm, gNorm, bNorm);
                            const d = max - min;

                            let h = 0;
                            if (d === 0) h = 0;
                            else if (max === rNorm) h = 60 * (((gNorm - bNorm) / d) % 6);
                            else if (max === gNorm) h = 60 * ((bNorm - rNorm) / d + 2);
                            else if (max === bNorm) h = 60 * ((rNorm - gNorm) / d + 4);

                            if (h < 0) h += 360;

                            const l = (max + min) / 2;
                            const s = d === 0 ? 0 : d / (1 - Math.abs(2 * l - 1));

                            // HSLスライダーの値を更新
                            this.hue = Math.round(h);
                            this.saturation = Math.round(s * 100);
                            this.lightness = Math.round(l * 100);
                        }
                    }
                },
                applyPreset(preset) {
                    if (this.colorMode == 'hsl') {
                        if (preset.name === 'RESET') {
                            this.hue = this.hue; // Keep current hue
                            this.saturation = 50;
                            this.lightness = 50;
                        } else {
                            this.hue = this.hue; // Keep current hue
                            this.saturation = preset.s;
                            this.lightness = preset.l;
                        }
                    }
                    else {
                        this.colorMode = 'hsl';
                        this.$nextTick(() => {
                            if (preset.name === 'RESET') {
                                this.hue = this.hue; // Keep current hue
                                this.saturation = 50;
                                this.lightness = 50;
                            } else {
                                this.hue = this.hue; // Keep current hue
                                this.saturation = preset.s;
                                this.lightness = preset.l;
                            }
                        });
                    }
                },
                handleWidthChange(value) {
                    if (this.maintainAspectRatio) {
                        this.imageHeight = Math.round(value / this.aspectRatio);
                    }
                },
                handleHeightChange(value) {
                    if (this.maintainAspectRatio) {
                        this.imageWidth = Math.round(value * this.aspectRatio);
                    }
                },
                copyToClipboard() {
                    const cssText = `background: ${this.gradientCSS};`;
                    navigator.clipboard.writeText(cssText).then(() => {
                        alert('コピーしました！');
                    }).catch(err => {
                        console.error('コピーに失敗しました:', err);
                    });
                },
                exportImage() {
                    const canvas = document.getElementById('exportCanvas');
                    canvas.width = this.imageWidth;
                    canvas.height = this.imageHeight;

                    const ctx = canvas.getContext('2d');

                    // Create gradient
                    let gradient;
                    if (this.gradientType === 'linear') {
                        const angleRad = (this.angle - 90) * Math.PI / 180;
                        const dist = Math.abs(this.imageWidth * Math.cos(angleRad)) + Math.abs(this.imageHeight * Math.sin(angleRad));
                        const startX = this.imageWidth / 2 - dist / 2 * Math.cos(angleRad);
                        const startY = this.imageHeight / 2 - dist / 2 * Math.sin(angleRad);
                        const endX = this.imageWidth / 2 + dist / 2 * Math.cos(angleRad);
                        const endY = this.imageHeight / 2 + dist / 2 * Math.sin(angleRad);

                        gradient = ctx.createLinearGradient(startX, startY, endX, endY);
                    } else {
                        gradient = ctx.createRadialGradient(
                            this.imageWidth / 2, this.imageHeight / 2, 0,
                            this.imageWidth / 2, this.imageHeight / 2,
                            Math.max(this.imageWidth, this.imageHeight) / 2
                        );
                    }

                    // Add color stops
                    gradient.addColorStop(0, this.colors[0]);
                    gradient.addColorStop(1, this.colors[1]);

                    // Fill canvas
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, this.imageWidth, this.imageHeight);

                    // Export as image
                    const link = document.createElement('a');
                    link.download = `gradient.${this.imageFormat}`;
                    const quality = this.imageFormat === 'jpeg' ? this.jpegQuality / 100 : 1;
                    link.href = canvas.toDataURL(`image/${this.imageFormat}`, quality);
                    link.click();
                },
                saveCurrentGradient() {
                    const gradientData = {
                        type: this.gradientType,
                        angle: this.angle,
                        colors: [...this.colors],
                        css: this.gradientCSS
                    };

                    // 重複チェック
                    const isDuplicate = this.savedGradients.some(g =>
                        g.type === gradientData.type &&
                        g.angle === gradientData.angle &&
                        JSON.stringify(g.colors) === JSON.stringify(gradientData.colors)
                    );

                    if (!isDuplicate) {
                        this.savedGradients.push(gradientData);
                        localStorage.setItem('savedGradients', JSON.stringify(this.savedGradients));
                    }
                },

                loadGradient(gradient) {
                    this.gradientType = gradient.type;
                    this.angle = gradient.angle;
                    this.colors = [...gradient.colors];
                },

                removeGradient(index) {
                    this.savedGradients.splice(index, 1);
                    localStorage.setItem('savedGradients', JSON.stringify(this.savedGradients));
                },
            },
            computed: {
                hexColor() {
                    if (this.colorMode === 'rgb') {
                        const r = this.red.toString(16).padStart(2, '0');
                        const g = this.green.toString(16).padStart(2, '0');
                        const b = this.blue.toString(16).padStart(2, '0');
                        return `#${r}${g}${b}`.toUpperCase();
                    } else {
                        const h = this.hue;
                        const s = this.saturation / 100;
                        const l = this.lightness / 100;

                        const c = (1 - Math.abs(2 * l - 1)) * s;
                        const x = c * (1 - Math.abs((h / 60) % 2 - 1));
                        const m = l - c / 2;

                        let r, g, b;
                        if (h >= 0 && h < 60) {
                            [r, g, b] = [c, x, 0];
                        } else if (h >= 60 && h < 120) {
                            [r, g, b] = [x, c, 0];
                        } else if (h >= 120 && h < 180) {
                            [r, g, b] = [0, c, x];
                        } else if (h >= 180 && h < 240) {
                            [r, g, b] = [0, x, c];
                        } else if (h >= 240 && h < 300) {
                            [r, g, b] = [x, 0, c];
                        } else {
                            [r, g, b] = [c, 0, x];
                        }

                        const rgb = [
                            Math.round((r + m) * 255),
                            Math.round((g + m) * 255),
                            Math.round((b + m) * 255)
                        ];

                        this.red = rgb[0];
                        this.green = rgb[1];
                        this.blue = rgb[2];

                        return `#${rgb.map(x => x.toString(16).padStart(2, '0')).join('')}`.toUpperCase();
                    }
                },
                gradientCSS() {
                    if (this.gradientType === 'linear') {
                        return `linear-gradient(${this.angle}deg, ${this.colors.join(', ')})`;
                    } else {
                        return `radial-gradient(circle, ${this.colors.join(', ')})`;
                    }
                },
                gradientStyle() {
                    return {
                        background: this.gradientCSS
                    };
                },
            },
            watch: {
                colorMode(newMode) {
                    if (newMode === 'hsl') {
                        const r = this.red / 255;
                        const g = this.green / 255;
                        const b = this.blue / 255;

                        const max = Math.max(r, g, b);
                        const min = Math.min(r, g, b);
                        const d = max - min;

                        let h = 0;
                        if (d === 0) h = 0;
                        else if (max === r) h = 60 * ((g - b) / d % 6);
                        else if (max === g) h = 60 * ((b - r) / d + 2);
                        else if (max === b) h = 60 * ((r - g) / d + 4);

                        if (h < 0) h += 360;

                        const l = (max + min) / 2;
                        const s = d === 0 ? 0 : d / (1 - Math.abs(2 * l - 1));

                        this.hue = Math.round(h);
                        this.saturation = Math.round(s * 100);
                        this.lightness = Math.round(l * 100);
                    }
                },
                hexColor: {
                    handler(newValue) {
                        this.hexInput = newValue;
                    },
                    immediate: true
                }
            },
            created() {
                // Load saved colors from localStorage
                const savedColors = localStorage.getItem('savedColors');
                if (savedColors) {
                    this.savedColors = JSON.parse(savedColors);
                }
                const savedGradients = localStorage.getItem('savedGradients');
                if (savedGradients) {
                    this.savedGradients = JSON.parse(savedGradients);
                }
            },
            mounted() {
                this.aspectRatio = this.imageWidth / this.imageHeight;
            }
        });
    </script>
</body>

</html>